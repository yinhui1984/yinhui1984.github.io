<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Uniswap - YINHUI&#39;s BLOG</title><meta name="Description" content="银辉的博客"><meta property="og:title" content="Uniswap" />
<meta property="og:description" content="uniswap API 解释与举例" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yinhui1984.github.io/uniswap/" /><meta property="og:image" content="https://yinhui1984.github.io/avatar.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-13T09:53:56+08:00" />
<meta property="article:modified_time" content="2023-03-13T09:53:56+08:00" /><meta property="og:site_name" content="YINHUI&#39;s BLOG" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://yinhui1984.github.io/avatar.png"/>

<meta name="twitter:title" content="Uniswap"/>
<meta name="twitter:description" content="uniswap API 解释与举例"/>
<meta name="application-name" content="YINHUI&#39;s BLOG">
<meta name="apple-mobile-web-app-title" content="YINHUI&#39;s BLOG"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://yinhui1984.github.io/uniswap/" /><link rel="prev" href="https://yinhui1984.github.io/analyse_of_egd_finance_attack/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Uniswap",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yinhui1984.github.io\/uniswap\/"
        },"genre": "posts","keywords": "swap, L3, Web3.0","wordcount":  9321 ,
        "url": "https:\/\/yinhui1984.github.io\/uniswap\/","datePublished": "2023-03-13T09:53:56+08:00","dateModified": "2023-03-13T09:53:56+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "yinhui"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="YINHUI&#39;s BLOG"></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/"> 首页 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="YINHUI&#39;s BLOG"></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/" title="">首页</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Uniswap</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/yinhui1984" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>yinhui</a></span>&nbsp;<span class="post-category">included in <a href="/categories/blockchain/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Blockchain</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-03-13">2023-03-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;9321 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;19 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#名词解释">名词解释</a>
      <ul>
        <li><a href="#fee-on-transfer-tokens">Fee-On-Transfer Tokens</a></li>
      </ul>
    </li>
    <li><a href="#uniswap-协议">uniswap 协议</a>
      <ul>
        <li><a href="#uniswap-v1">uniswap V1</a></li>
        <li><a href="#uniswap-v2">uniswap V2</a></li>
        <li><a href="#uniswarp-v3">uniswarp V3</a></li>
      </ul>
    </li>
    <li><a href="#v2合约">V2合约</a>
      <ul>
        <li><a href="#facotry">Facotry</a>
          <ul>
            <li><a href="#地址">地址</a></li>
            <li><a href="#接口">接口</a>
              <ul>
                <li><a href="#event-paircreated">event PairCreated</a></li>
                <li><a href="#allpairs">allPairs</a></li>
                <li><a href="#getpair">getPair</a></li>
                <li><a href="#allpairslength">allPairsLength</a></li>
                <li><a href="#feeto">feeTo</a></li>
                <li><a href="#feetosetter">feeToSetter</a></li>
                <li><a href="#createpair">createPair</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#pair">Pair</a>
          <ul>
            <li><a href="#地址-1">地址</a>
              <ul>
                <li><a href="#方式1">方式1:</a></li>
                <li><a href="#方式2">方式2</a></li>
              </ul>
            </li>
            <li><a href="#接口-1">接口</a>
              <ul>
                <li><a href="#event-mint">event Mint</a></li>
                <li><a href="#event-burn">event Burn</a></li>
                <li><a href="#event-swap">event Swap</a></li>
                <li><a href="#event-sync">event Sync</a></li>
                <li><a href="#minimum_liquidity">MINIMUM_LIQUIDITY</a></li>
                <li><a href="#factory">factory</a></li>
                <li><a href="#token0-token1">token0 token1</a></li>
                <li><a href="#getreserves">getReserves</a></li>
                <li><a href="#price0cumulativelast-----price1cumulativelast">price0CumulativeLast     price1CumulativeLast</a></li>
                <li><a href="#klast">kLast</a></li>
                <li><a href="#mint">mint</a></li>
                <li><a href="#burn">burn</a></li>
                <li><a href="#swap">swap</a></li>
                <li><a href="#skim">skim</a></li>
                <li><a href="#sync">sync</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#pair-erc20">Pair (ERC20)</a>
          <ul>
            <li><a href="#permit">permit</a></li>
          </ul>
        </li>
        <li><a href="#router01">Router01</a></li>
        <li><a href="#router02">Router02</a>
          <ul>
            <li><a href="#地址-2">地址</a></li>
            <li><a href="#接口-2">接口</a>
              <ul>
                <li><a href="#factory-1">factory</a></li>
                <li><a href="#weth">WETH</a></li>
                <li><a href="#quote-getamountout-getamountin-getamountsout-getamountsin">quote getAmountOut getAmountIn getAmountsOut getAmountsIn</a></li>
                <li><a href="#addliquidity">addLiquidity</a></li>
                <li><a href="#addliquidityeth">addLiquidityETH</a></li>
                <li><a href="#removeliquidity-removeliquidityeth">removeLiquidity removeLiquidityETH</a></li>
                <li><a href="#removeliquiditywithpermit--removeliquidityethwithpermit">removeLiquidityWithPermit  removeLiquidityETHWithPermit</a></li>
                <li><a href="#removeliquidityethsupportingfeeontransfertokens">removeLiquidityETHSupportingFeeOnTransferTokens</a></li>
                <li><a href="#swap_xxx">swap_xxx</a></li>
                <li><a href="#swap_xxx_fortokenssupportingfeeontransfertokens">swap_xxx_ForTokensSupportingFeeOnTransferTokens</a></li>
              </ul>
            </li>
            <li><a href="#library">Library</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>uniswap API 解释与举例</p>
<h2 id="名词解释">名词解释</h2>
<ul>
<li>Uniswap lab: 开发Uniswap协议的公司，同时也开发了网络界面。</li>
<li>Uniswap Protocol: 一套持久的、<strong>不可升级</strong>的智能合约，共同创建了一个自动做市商，该协议促进了以太坊区块链上ERC-20代币的点对点做市和交换。</li>
<li><a href="https://app.uniswap.org/#/swap" target="_blank" rel="noopener noreffer ">Uniswap Interface:</a> 一个网络界面，允许与Uniswap协议轻松互动。该界面只是人们与Uniswap协议互动的众多方式之一。</li>
<li>Uniswap Governance: 用于管理Uniswap协议的治理系统，由UNI代币启用。</li>
</ul>
<h3 id="fee-on-transfer-tokens">Fee-On-Transfer Tokens</h3>
<p>手续费转移代币（Fee-On-Transfer Tokens）是一种特殊类型的代币，其主要特点是在代币转移的同时，会从转移金额中抽取一定比例的代币作为手续费，并将这部分代币转移给代币的持有者或其他地址。</p>
<p>这种代币主要用于在代币交易过程中收取手续费，而不需要代币交易双方自行支付手续费。通常，这种代币的手续费率是在交易发生时动态计算的，通常以固定比例或动态算法的形式进行计算。手续费可以用于维护代币的生态系统，支持开发者、社区等。</p>
<p>在 Uniswap 中，如果一个代币是 Fee-On-Transfer Tokens，那么在将其从流动性池中移除时，需要根据代币在池子中的比例计算手续费，并将其转移到 Uniswap 协议的费用池中。这样，就可以避免在代币交易时需要交纳手续费的麻烦，使得代币交易更加方便快捷。</p>
<p>一些实际存在的 Fee-On-Transfer Tokens 包括：Safemoon、Reflect.finance、Moonrat、ElonGate等。</p>
<p>以 Safemoon 为例，Safemoon 是一种基于 Binance Smart Chain 的 Fee-On-Transfer Tokens，其交易手续费为 10%，其中 5% 作为交易流动性提供者的奖励，5% 作为持有者的奖励。当持有者在交易时出售 Safemoon 代币时，交易中的 10% 会被抽取为手续费，其中 5% 会自动流向交易对的流动性池子，另外 5% 会按比例分配给 Safemoon 的所有持有者。</p>
<p>Reflect.finance 是另一个 Fee-On-Transfer Tokens，它的交易手续费是 2%。在交易时，2% 的代币会被抽取为手续费，其中 1% 将会自动流向交易对的流动性池，另外 1% 会按比例分配给所有的持有者。</p>
<p>这些代币的特点是：在代币转移的过程中，一定比例的代币会被抽取为手续费，并按照一定的规则进行分配。这种设计可以激励代币持有者长期持有代币，并有助于代币的价格稳定性。</p>
<h2 id="uniswap-协议">uniswap 协议</h2>
<p><a href="https://docs.uniswap.org/concepts/uniswap-protocol" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/concepts/uniswap-protocol</a></p>
<p>Uniswap协议是一个点对点系统，旨在交换以太坊区块链上的加密货币（ERC-20代币）。该协议被实现为一套持久的、不可升级的智能合约；旨在优先考虑抗审查、安全、自我监护，并在没有任何可信任的中介机构可能选择性地限制访问的情况下运作。</p>
<p>uniswap使用自动做市商（AMM, Auto Market Making），有时被称为恒定功能做市商，来代替订单簿(order book)。</p>
<p><strong>AMM用两种资产的流动性池取代了订单簿市场上的买卖订单，这两种资产都是相对于对方的价值。当一种资产被交易为另一种资产时，两种资产的相对价格就会发生变化，两种资产的新市场价格就会确定</strong>。在这种动态中，买方或卖方直接与资金池进行交易，而不是与其他各方留下的具体订单进行交易。</p>
<h3 id="uniswap-v1">uniswap V1</h3>
<p>交易是针对智能合约或流动性池的，一个数学公式决定了资产的价格。流动性提供者向帮助做市的池子增加流动性。</p>
<p>在Uniswap流动性池中，交易资产对的比例应该是恒定的。其数学表达式为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">X * Y = K
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">X :第一种资产的储备
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Y : 第二中资产的储备
</span></span></code></pre></td></tr></table>
</div>
</div><p>流动性提供者应以K的方式增加流动性，使其不发生变化。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png"
        data-srcset="https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png, https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png 1.5x, https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png 2x"
        data-sizes="auto"
        alt="https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png"
        title="https://miro.medium.com/max/1050/1*CLjUpP1efeDdXeU-dJRBJw.png" /></p>
<p>Uniswap v1只支持ETH-ERC 20对的互换。如果用户希望将USDC换成DAI，第一步是将USDC换成ETH，然后兑换ETH-DAI，得到DAI。Uniswap v1还促进了LP代币的概念。当流动性提供者（LPs）向任何池子增加流动性时，他们会收到代表增加的流动性的LP代币。然后，这些LP代币可以被押注或燃烧，以赎回奖励。为了奖励流动性提供者，会产生0.3%的交易费。</p>
<h3 id="uniswap-v2">uniswap V2</h3>
<p>Uniswap v1的主要缺点是 &ldquo;ETH桥接 &ldquo;问题，即缺乏ERC20-ERC20代币池。这导致了当用户想要交换一个ERC20代币时，成本上升和高滑点(high slippage)</p>
<p>Uniswap v2在用户界面和体验上比v1好得多。同时，它通过引入ERC20-ERC20池的概念，消除了ETH桥接的问题。另一个重要的区别是在核心合约中使用wrapped ETH，而不是原生ETH。然而，交易者可以通过辅助合约使用ETH。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png"
        data-srcset="https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png, https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png 1.5x, https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png 2x"
        data-sizes="auto"
        alt="https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png"
        title="https://miro.medium.com/max/1050/1*HeCiFcK_4LjKmK14Iy37BQ.png" /></p>
<p>Uniswap v2的闪电互换(<code>FlashSwap</code>)概念允许用户提取任何数量的ERC20代币，而不需要预先付款。但他们可以为提取的代币付款，或支付一部分并归还其余部分，或归还所有提取的代币。这些事情可以在交易执行结束时进行。</p>
<p>Uniswap v2还引入了协议费。社区治理在开启/关闭这项费用方面起着至关重要的作用。0.3%的交易费中的0.05%的协议费将被保留给塑造网络路线图的Uniswap平台的发展。</p>
<h3 id="uniswarp-v3">uniswarp V3</h3>
<p>Uniswap v3旨在超越基于稳定币的AMM和集中式交易所，提供更好的资本效率和准确性，更灵活的收费结构，以及流动性提供者根据自己的喜好建立独特的价格曲线的能力。Uniswap v3还允许LPs在自定义的价格范围内集中他们的资本，增强所需价格的流动性，并在市场超出LP指定的价格范围时自动从池中移除流动性。Uniswap v3的收费结构是由社区管理的，包括三个不同的收费等级。</p>
<h2 id="v2合约">V2合约</h2>
<h3 id="facotry">Facotry</h3>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/factory" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/factory</a></p>
<p>在 Uniswap 协议中，Factory 是指 Uniswap 的工厂合约，它是创建 Uniswap 市场的主要合约。它的作用是充当中央化的市场制造商，允许任何人在 Uniswap 上创建自己的交易对，例如 ETH/DAI 或 USDC/DAI 等。</p>
<p>当一个用户想要创建一个新的交易对时，他们会将资产添加到 Liquidity Pool 中，这个过程会触发 Factory 合约，Factory 合约会根据输入的两种资产类型的地址创建一个新的交易对，并将 Liquidity Pool 添加到新创建的交易对中。Factory 合约还负责为每个新的交易对创建对应的交易对合约，以便交易对的交易可以被执行。</p>
<h4 id="地址">地址</h4>
<p><a href="https://etherscan.io/address/0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f#code" target="_blank" rel="noopener noreffer ">0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f</a></p>
<h4 id="接口">接口</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#39;@uniswap/v2-core/contracts/interfaces/IUniswapV2Factory.sol&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">IUniswapV2Factory</span> <span class="nx">from</span> <span class="s1">&#39;@uniswap/v2-core/build/IUniswapV2Factory.json&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">IUniswapV2Factory</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">PairCreated</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">token0</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">token1</span><span class="p">,</span> <span class="kt">address</span> <span class="n">pair</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">getPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">allPairs</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">allPairsLength</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">feeTo</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">feeToSetter</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">createPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>下面所有的举例都假设你设置了 ETH_RPC_URL=<mainnet> 环境变量</p>
</blockquote>
<h5 id="event-paircreated">event PairCreated</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">event</span> <span class="nc">PairCreated</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">token0</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">token1</span><span class="p">,</span> <span class="kt">address</span> <span class="n">pair</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="allpairs">allPairs</h5>
<p>获取第N个交易对</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">allPairs</span><span class="p">(</span><span class="kt">uint</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 返回第1个pair的地址: 0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc</span>
</span></span><span class="line"><span class="cl">cast call 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f  <span class="s2">&#34;allPairs(uint)(address)&#34;</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回pair的token0的地址: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span>
</span></span><span class="line"><span class="cl">cast call 0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc <span class="s2">&#34;token0()(address)&#34;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回token0名称: USD Coin</span>
</span></span><span class="line"><span class="cl">cast call 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48 <span class="s2">&#34;name()(string)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回pair的token1的地址: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span>
</span></span><span class="line"><span class="cl">cast call 0xB4e16d0168e52d35CaCD2c6185b44281Ec28C9Dc <span class="s2">&#34;token1()(address)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 返回token1名称: Wrapped Ether</span>
</span></span><span class="line"><span class="cl">cast call 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2  <span class="s2">&#34;name()(string)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 所以第一个交易对是 USD Coin 和 Wrapped Ether</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="getpair">getPair</h5>
<p>传入token1和token2地址, 查询对应的pair地址 (不存在返回0x0)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">getPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 比如查询 DAI-USDC交易对对应的Pair</span>
</span></span><span class="line"><span class="cl"><span class="c1"># DAI: 0x6B175474E89094C44Da98b954EedeAC495271d0F</span>
</span></span><span class="line"><span class="cl"><span class="c1"># USDC: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 返回: 0xAE461cA67B15dc8dc81CE7615e0320dA1A9aB8D5</span>
</span></span><span class="line"><span class="cl">cast call 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f <span class="s2">&#34;getPair(address,address)(address)&#34;</span> 0x6B175474E89094C44Da98b954EedeAC495271d0F  0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="allpairslength">allPairsLength</h5>
<p>返回pair总数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">function allPairsLength() external view returns (uint);
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 返回 150745</span>
</span></span><span class="line"><span class="cl">cast call 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f  <span class="s2">&#34;allPairsLength()(uint)&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="feeto">feeTo</h5>
<p>手续费收取人地址.</p>
<p>当用户在 Uniswap 上进行交易时，交易所收取的费用将被分成两部分：一部分将被直接销毁（burn），另一部分将被分配给 <code>feeTo</code> 函数指定的地址。销毁的部分是为了保证 Uniswap 协议中的流动性资产总量不会因为手续费的积累而增加，而分配给 <code>feeTo</code> 函数指定的地址的部分则可以被用于奖励交易所，例如支付给开发者或用于项目运营等。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">feeToSetter</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>目前 feeTo的地址是0x0</p>
<p>参考这里:  <a href="https://docs.uniswap.org/contracts/v2/concepts/advanced-topics/fees#protocol-charge-calculation" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/concepts/advanced-topics/fees#protocol-charge-calculation</a></p>
<h5 id="feetosetter">feeToSetter</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">feeToSetter</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>获取可以更新feeTo地址的地址 (The address allowed to change <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/factory#feeto" target="_blank" rel="noopener noreffer ">feeTo</a>.)</p>
<h5 id="createpair">createPair</h5>
<p>创建Pair. (Creates a pair for <code>tokenA</code> and <code>tokenB</code> if one doesn&rsquo;t exist already.)</p>
<blockquote>
<p>创建时tokenA和tokenB的传入顺序是由影响的, 因为Pair的地址是这样计算的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">pairAddress2</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint160</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">uint</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">keccak256</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                <span class="s">hex&#34;ff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">factory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nb">keccak256</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span><span class="n">tokenA</span><span class="p">,</span> <span class="n">tokenB</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                                <span class="s">hex&#34;96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">createPair</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="kt">address</span> <span class="n">tokenB</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">pair</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: SEE LICENSE IN LICENSE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;forge-std/Test.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install OpenZeppelin/openzeppelin-contracts --no-commit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install --no-commit  Uniswap/v2-core
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Factory.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Pair.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">constant</span> <span class="n">UNISWAP_V2_FACTORY_ADDRESS</span> <span class="o">=</span> <span class="mh">0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">address</span> <span class="k">constant</span> <span class="n">USDT_ADDRESS</span> <span class="o">=</span> <span class="mh">0xdAC17F958D2ee523a2206206994597C13D831ec7</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">ExampleToken</span> <span class="k">is</span> <span class="n">ERC20</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="k">memory</span> <span class="n">_symbol</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="n">ERC20</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">initSupply</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mint</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">initSupply</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">CreatePairTest</span> <span class="k">is</span> <span class="n">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">IUniswapV2Factory</span> <span class="n">facotry</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ExampleToken</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">IERC20</span> <span class="n">usdt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">setUp</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//[rpc_endpoints]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//mainnet = &#34;${ETH_RPC_URL}&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">vm</span><span class="p">.</span><span class="n">createSelectFork</span><span class="p">(</span><span class="s">&#34;mainnet&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">facotry</span> <span class="o">=</span> <span class="n">IUniswapV2Factory</span><span class="p">(</span><span class="n">UNISWAP_V2_FACTORY_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">usdt</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="n">USDT_ADDRESS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExampleToken</span><span class="p">(</span><span class="s">&#34;EXAMPLE&#34;</span><span class="p">,</span> <span class="s">&#34;EXT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">testCreatePair</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">pairLengthBefore</span> <span class="o">=</span> <span class="n">facotry</span><span class="p">.</span><span class="n">allPairsLength</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair length before:&#34;</span><span class="p">,</span> <span class="n">facotry</span><span class="p">.</span><span class="n">allPairsLength</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">pairAddress</span> <span class="o">=</span> <span class="n">facotry</span><span class="p">.</span><span class="n">createPair</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">ext</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">usdt</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair address:&#34;</span><span class="p">,</span> <span class="n">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">IUniswapV2Pair</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">IUniswapV2Pair</span><span class="p">(</span><span class="n">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ERC20</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">token0</span><span class="p">()).</span><span class="n">symbol</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s">&#34;-&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">ERC20</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">token1</span><span class="p">()).</span><span class="n">symbol</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span> <span class="n">pairLengthAfter</span> <span class="o">=</span> <span class="n">facotry</span><span class="p">.</span><span class="n">allPairsLength</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair length after:&#34;</span><span class="p">,</span> <span class="n">facotry</span><span class="p">.</span><span class="n">allPairsLength</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="nb">assert</span><span class="p">(</span><span class="n">pairLengthAfter</span> <span class="o">==</span> <span class="n">pairLengthBefore</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[PASS] testCreatePair() (gas: 2518336)
</span></span><span class="line"><span class="cl">Logs:
</span></span><span class="line"><span class="cl">  pair length before: 150948
</span></span><span class="line"><span class="cl">  pair address: 0xEC42F3DDD5940F2be204938e6b0C70fC72c4aE85
</span></span><span class="line"><span class="cl">  EXT - USDT
</span></span><span class="line"><span class="cl">  pair length after: 150949
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pair">Pair</h3>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair</a></p>
<p>在Uniswap中，Pair是指一对代币的交易池，用于交换这两种代币。Uniswap的交易池采用自动做市商模型（Automated Market Maker，AMM），也就是说，它们通过智能合约自动确定代币的价格，而不是依赖于传统的买卖订单簿。</p>
<p>每个Pair都有一个唯一的地址，由代币的合约地址计算而来。例如，在ETH/USDT交易对中，ETH和USDT的代币合约地址会被组合成一个新的地址，该地址就是Pair的地址。</p>
<p>每个Pair中都会存储相应代币的余额和汇率，汇率是指一个代币相对于另一个代币的价格比率。当用户在一个Pair中进行交易时，他们会把一种代币发送到该Pair的智能合约地址，智能合约会自动计算出相应的汇率，然后返回等值的另一种代币。</p>
<p>当用户在Uniswap上创建一个新的交易对时，会通过调用Factory合约的createPair函数来创建新的Pair。createPair函数会将两个代币的合约地址作为输入参数，并使用这些地址来计算Pair的地址。创建成功后，该Pair将被添加到Uniswap中，并且用户就可以在该Pair中进行交易了。</p>
<p>每个Pair都有一个自己的代币，称为LP代币或流动性代币（Liquidity Provider Token）。当一个用户向Pair中提供流动性时，他们会收到相应数量的LP代币，这些代币代表用户向交易池中贡献的流动性。</p>
<p>LP代币可以用于多种用途。首先，用户可以随时将其赎回，以取回相应的流动性。此外，LP代币也可以用于投票和治理，例如，在Uniswap的治理中，持有LP代币的用户可以投票表决关于Uniswap协议的决策。最后，用户还可以将其LP代币质押到各种流动性挖矿平台上，以获取代币的奖励。</p>
<p>LPs(流动性提供商)可以通过向池子里添加代币来赚取交易费，以获得LP代币的奖励</p>
<p>需要注意的是，每个Pair的LP代币是独立的，不同的交易对将有不同的LP代币。此外，LP代币的价值是根据Pair中存储的代币余额和汇率来计算的，因此它们的价值会随着Pair中代币余额和价格的变化而变化。</p>
<h4 id="地址-1">地址</h4>
<h5 id="方式1">方式1:</h5>
<p>使用Factory的<code>getPair</code>函数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 比如查询 DAI-USDC交易对对应的Pair</span>
</span></span><span class="line"><span class="cl"><span class="c1"># DAI: 0x6B175474E89094C44Da98b954EedeAC495271d0F</span>
</span></span><span class="line"><span class="cl"><span class="c1"># USDC: 0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 返回: 0xAE461cA67B15dc8dc81CE7615e0320dA1A9aB8D5</span>
</span></span><span class="line"><span class="cl">cast call 0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f <span class="s2">&#34;getPair(address,address)(address)&#34;</span> 0x6B175474E89094C44Da98b954EedeAC495271d0F  0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="方式2">方式2</h5>
<p>Pair是通过<a href="https://www.evm.codes/?fork=merge" target="_blank" rel="noopener noreffer ">Create2</a> 创建的, 所以其地址是可以计算出来的, 参考这里 <a href="https://docs.uniswap.org/contracts/v2/guides/smart-contract-integration/getting-pair-addresses" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/guides/smart-contract-integration/getting-pair-addresses</a></p>
<p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">testPairAddress</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">factory</span> <span class="o">=</span> <span class="mh">0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">token0</span> <span class="o">=</span> <span class="mh">0x6B175474E89094C44Da98b954EedeAC495271d0F</span><span class="p">;</span> <span class="c1">// DAI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">address</span> <span class="n">token1</span> <span class="o">=</span> <span class="mh">0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span><span class="p">;</span> <span class="c1">// USDC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				<span class="c1">//方式1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">address</span> <span class="n">pairAddress1</span> <span class="o">=</span> <span class="n">IUniswapV2Factory</span><span class="p">(</span><span class="n">factory</span><span class="p">).</span><span class="n">getPair</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">token0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">token1</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//方式2 (下面的代码对于任何pair都一样, 不用变)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">address</span> <span class="n">pairAddress2</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="kt">uint160</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="kt">uint</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                        <span class="nb">keccak256</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                            <span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                                <span class="s">hex&#34;ff&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="n">factory</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nb">keccak256</span><span class="p">(</span><span class="nb">abi</span><span class="p">.</span><span class="nb">encodePacked</span><span class="p">(</span><span class="n">token0</span><span class="p">,</span> <span class="n">token1</span><span class="p">)),</span>
</span></span><span class="line"><span class="cl">                                <span class="s">hex&#34;96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair address 1:&#34;</span><span class="p">,</span> <span class="n">pairAddress1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair address 2:&#34;</span><span class="p">,</span> <span class="n">pairAddress2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">assert</span><span class="p">(</span><span class="n">pairAddress1</span> <span class="o">==</span> <span class="n">pairAddress2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中 <code>96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f</code> 是uniswap创建pair时传递给creat2的 keccak256(init_code)</p>
<h4 id="接口-1">接口</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#39;@uniswap/v2-core/contracts/interfaces/IUniswapV2Pair.sol&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">import</span> <span class="err">IUniswapV</span><span class="mi">2</span><span class="err">Pair</span> <span class="err">from</span> <span class="err">&#39;@uniswap/v</span><span class="mi">2</span><span class="err">-core/build/IUniswapV</span><span class="mi">2</span><span class="err">Pair.json&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="k">pragma solidity</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">IUniswapV2Pair</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Approval</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="k">from</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">name</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">symbol</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">decimals</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">totalSupply</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">allowance</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">spender</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">approve</span><span class="p">(</span><span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">transferFrom</span><span class="p">(</span><span class="kt">address</span> <span class="k">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">DOMAIN_SEPARATOR</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">PERMIT_TYPEHASH</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">nonces</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">permit</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">deadline</span><span class="p">,</span> <span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Mint</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Burn</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Swap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint</span> <span class="n">amount0In</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint</span> <span class="n">amount1In</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">event</span> <span class="nc">Sync</span><span class="p">(</span><span class="kt">uint112</span> <span class="n">reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">reserve1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">MINIMUM_LIQUIDITY</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">factory</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">token0</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">token1</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">getReserves</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint112</span> <span class="n">reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">reserve1</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">blockTimestampLast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">price0CumulativeLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">price1CumulativeLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">kLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">calldata</span> <span class="nb">data</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">skim</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nf">sync</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="event-mint">event Mint</h5>
<p>当流动性代币被铸造(<code>mint()</code>)的时候触发</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">event</span> <span class="nc">Mint</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="event-burn">event Burn</h5>
<p>当流动性代币被销毁(<code>burn()</code>)的时候触发</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">event</span> <span class="nc">Burn</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="event-swap">event Swap</h5>
<p>当 <code>swap()</code>函数被成功调用后触发</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">event</span> <span class="nc">Swap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="kt">address</span> <span class="k">indexed</span> <span class="nb">sender</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amount0In</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amount1In</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="event-sync">event Sync</h5>
<p><code>mint</code> <code>burn</code> <code>swap</code> <code>sync</code> 时都会触发</p>
<h5 id="minimum_liquidity">MINIMUM_LIQUIDITY</h5>
<p>返回 流动性代币最小值 (固定值1000)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">MINIMUM_LIQUIDITY</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 1000</span>
</span></span><span class="line"><span class="cl">cast call 0xAE461cA67B15dc8dc81CE7615e0320dA1A9aB8D5 <span class="s2">&#34;MINIMUM_LIQUIDITY()(uint)&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>每对交易对（pair）都会在合约创建时初始化一个名为MINIMUM_LIQUIDITY的变量。该变量是一个固定值(1000)，用于确保交易对的初始流动性总量大于零。这意味着在交易对中添加流动性之前，必须先添加至少1000个流动性代币（Liquidity Token）才能完成初始化.MINIMUM_LIQUIDITY的存在是为了防止某些攻击，例如闪电贷攻击，其可能会通过在交易对中添加和删除大量流动性代币来操纵价格和市场深度。由于MINIMUM_LIQUIDITY的存在，这种攻击在Uniswap中不再有效。</p>
<p>需要注意的是，一旦交易对的流动性代币数量超过了MINIMUM_LIQUIDITY，该变量的值对交易对的操作不再有影响，而仅仅是一个初始化时的限制。</p>
<h5 id="factory">factory</h5>
<p>返回生成该Pair的Factory的地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">factory</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="token0-token1">token0 token1</h5>
<p>返回对应的两个token的地址</p>
<p>谁是token0</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">token0</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">token1</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="getreserves">getReserves</h5>
<p>返回 token0, token1的储备量. 这个储备量会用于<a href="https://docs.uniswap.org/contracts/v2/concepts/advanced-topics/pricing" target="_blank" rel="noopener noreffer ">定价</a>和分配流动性, 还返回最后一次与Pair交互的时间</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">getReserves</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint112</span> <span class="n">reserve0</span><span class="p">,</span> <span class="kt">uint112</span> <span class="n">reserve1</span><span class="p">,</span> <span class="kt">uint32</span> <span class="n">blockTimestampLast</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cast call 0xAE461cA67B15dc8dc81CE7615e0320dA1A9aB8D5 <span class="s2">&#34;getReserves()(uint112,uint112,uint32)&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 17855224108246409584874388</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 17830344327957</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1678333223</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="price0cumulativelast-----price1cumulativelast">price0CumulativeLast     price1CumulativeLast</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">price0CumulativeLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">price1CumulativeLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>价格累积函数（Price Cumulative Function）是Uniswap用来计算某个交易对价格的一种方式。每当交易对的价格发生变化时，价格累积函数的值就会更新。</p>
<p>在Uniswap中，每个Pair都有两个价格累积函数，分别称为<code>price0CumulativeLast</code>和<code>price1CumulativeLast</code>。其中，<code>price0CumulativeLast</code>表示当前Pair的第一个代币（Token0）的价格累积函数的值，而<code>price1CumulativeLast</code>表示当前Pair的第二个代币（Token1）的价格累积函数的值。</p>
<p>具体来说，<code>price0CumulativeLast</code>函数表示从创建Pair以来，Token1在交易中累计出售量与Token0价格乘积的累加值。也就是说，如果当前Pair的价格为P，Token1的数量为Q，则<code>price0CumulativeLast</code>的值为P*Q的累加和。</p>
<p>在Uniswap中，根据价格累积函数的值可以计算出当前价格，从而实现交易对的价格发现。例如，对于一个Pair，假设当前的<code>price0CumulativeLast</code>值为X，上一次交易时的<code>price0CumulativeLast</code>值为Y，上一次交易时的时间为T，则当前价格P0（即Token0相对于Token1的价格）可以通过以下公式计算得出：</p>
<p><code>P0 = (X - Y) / (Q1 - Q0)</code></p>
<p>其中，Q1和Q0分别表示两次交易时的Token1数量。</p>
<p>因此，<code>price0CumulativeLast</code>函数在Uniswap中扮演着重要的角色，用于计算交易对的价格以及实现交易对的自动价格发现功能。</p>
<h5 id="klast">kLast</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">kLast</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>每个交易对（Pair）都有一个参数叫做&quot;k&quot;值，它表示该交易对的流动性大小。&ldquo;k&quot;值是由该交易对中两种资产的余额相乘得出的。例如，对于一个交易对，其中ETH余额为100，ERC20代币余额为200，则该交易对的&quot;k&quot;值为20,000（100 * 200 = 20,000）。</p>
<p>kLast是一个在Uniswap合约中的函数，它用于记录交易之前的&quot;k&quot;值。具体来说，当一个交易对发生交易时，该函数会记录下当前交易对的&quot;k&quot;值，并在交易完成后更新&quot;k&quot;值。这样做的目的是为了方便后续计算交易手续费。</p>
<p>在每次交易完成后，&ldquo;k&quot;值都会更新，因此记录下交易之前的&quot;k&quot;值可以方便地计算出交易手续费。如果没有记录下&quot;k&quot;值，计算交易手续费将会更加复杂，因为需要重新计算交易对的&quot;k&quot;值。</p>
<h5 id="mint">mint</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">mint</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>铸造该Pair的流动性代币</p>
<p>它会触发 <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair#mint" target="_blank" rel="noopener noreffer ">Mint</a>, <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair#sync" target="_blank" rel="noopener noreffer ">Sync</a>, <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair-erc-20#transfer" target="_blank" rel="noopener noreffer ">Transfer</a> 事件</p>
<h5 id="burn">burn</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">burn</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">amount0</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>销毁该Pair的流动性代币</p>
<p>它会触发<a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair#burn" target="_blank" rel="noopener noreffer ">Burn</a>, <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair#sync" target="_blank" rel="noopener noreffer ">Sync</a>, <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair-erc-20#transfer" target="_blank" rel="noopener noreffer ">Transfer</a> 事件</p>
<h5 id="swap">swap</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">swap</span><span class="p">(</span><span class="kt">uint</span> <span class="n">amount0Out</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amount1Out</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">calldata</span> <span class="nb">data</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>swap</code>是用于执行资产交易的函数。当用户想要交换一种代币或加密货币为另一种代币或加密货币时，他们会调用该函数。</p>
<p>swap函数的参数包括输入代币的地址、输出代币的地址、输入代币的数量、输出代币的最小数量和交易的接收地址。其中，输入代币的地址和数量是必需的，而输出代币的地址和最小数量是可选的。</p>
<p>当用户调用swap函数时，Uniswap合约会自动计算输出代币的数量，并将其转移到交易的接收地址。在这个过程中，Uniswap合约会根据交易对中的&quot;k&quot;值来计算交易手续费，并将其分配给流动性提供者和Uniswap协议。</p>
<p>需要注意的是，由于Uniswap采用自动做市商模型，交易对中的价格是由市场供需关系动态决定的，因此在执行swap函数时，交易对的价格可能已经发生了变化，从而影响到交易的成交价格和数量。</p>
<p>它会触发 <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/pair#swap" target="_blank" rel="noopener noreffer ">Swap</a>, [Sync 事件.</p>
<h5 id="skim">skim</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">skim</span><span class="p">(</span><span class="kt">address</span> <span class="n">to</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当交易对中的其中一种代币被交易时，交易对中的另一种代币的数量会发生变化。这个变化会影响交易对中的比例，从而影响到交易对的价格。</p>
<p>skim函数是Uniswap交易对合约中的一个函数，其作用是将一个代币从交易对中提取出来，使得交易对中的两种代币之间的比例重新平衡。这个过程通常发生在交易对中某一种代币流动性不足时，需要将交易对中的另一种代币提取出来以增加流动性。</p>
<p>具体来说，当一个代币被从交易对中提取出来时，skim函数会将代币的数量除以交易对中剩余另一种代币的数量，从而确定提取的代币在当前价格下的价值。然后，这个价值会从交易对中另一种代币的余额中减去，以重新平衡交易对中两种代币的比例。</p>
<h5 id="sync">sync</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">sync</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>当某个交易对的价格发生变化时，需要调整交易对的储备量（Reserve），以确保交易对中代币的比例始终保持不变。这个过程就是通过Sync函数实现的。</p>
<p>具体来说，Sync函数会计算出当前交易对中每个代币的储备量，并将其与区块链上实际的代币储备量进行比较。如果区块链上的代币储备量与计算出来的储备量不一致，Sync函数会调整交易对的储备量，使其与区块链上的储备量一致。这个过程会同时更新交易对的价格，并在交易对中添加或移除代币。</p>
<p>需要注意的是，Sync函数并不是直接调整交易对的价格，而是通过调整交易对中的储备量来影响价格。因此，在Sync函数调用之前，需要先进行价格计算，以确定储备量需要被调整的方向。</p>
<h3 id="pair-erc20">Pair (ERC20)</h3>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/Pair-ERC-20#allowance" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/Pair-ERC-20#allowance</a></p>
<p>参考上面的链接, 为流动性代币实现的ERC20的相关功能</p>
<p>特别说明的是permit</p>
<h4 id="permit">permit</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">permit</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint</span> <span class="nb">value</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">deadline</span><span class="p">,</span> <span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">s</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>它的作用是让一个地址 spender 能够代表一个地址 owner 进行一定数量的代币交易，而不需要在每次交易之前都得到 owner 的授权</strong>。</p>
<p><code>permit</code> 函数是 ERC20 中的一种新型授权机制，它允许用户在一次操作中同时授权 spender 进行一定数量的代币交易，并设置一个过期时间 deadline。通过 permit 函数进行授权，可以避免用户在每次交易之前都需要通过传统的 approve 函数进行授权过程。</p>
<p>而 Uniswap 中的 permit 函数则是将这种授权机制集成到了交易过程中。当某个地址需要进行交易时，它可以先调用 permit 函数进行授权，然后再直接进行交易。这样既方便了用户，也提高了交易的效率。</p>
<p>owner：需要进行授权的地址；
spender：被授权的地址；
value：被授权的代币数量；
deadline：授权过期时间戳；
v、r、s：用于签名验证的参数(ECDSA 签名算法)</p>
<blockquote>
<p>需要注意的是，这个函数需要用户先对授权进行签名，因此它并不是直接调用的。一般来说，用户需要通过一些其他的工具或者库来进行签名，然后再将签名后的数据作为参数传入到 permit 函数中。</p>
</blockquote>
<h3 id="router01">Router01</h3>
<p>地址  <a href="https://etherscan.io/address/0xf164fC0Ec4E93095b804a4795bBe1e041497b92a" target="_blank" rel="noopener noreffer ">0xf164fC0Ec4E93095b804a4795bBe1e041497b92a</a></p>
<blockquote>
<p>Router01有bug被弃用了</p>
</blockquote>
<h3 id="router02">Router02</h3>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02</a></p>
<h4 id="地址-2">地址</h4>
<p><a href="https://etherscan.io/address/0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D" target="_blank" rel="noopener noreffer ">0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D</a></p>
<h4 id="接口-2">接口</h4>
<p><a href="https://github.com/Uniswap/v2-periphery" target="_blank" rel="noopener noreffer ">https://github.com/Uniswap/v2-periphery</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#39;@uniswap/v2-periphery/contracts/interfaces/IUniswapV2Router02.sol&#39;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">import</span> <span class="err">IUniswapV</span><span class="mi">2</span><span class="err">Router</span><span class="mi">02</span> <span class="err">from</span> <span class="err">&#39;@uniswap/v</span><span class="mi">2</span><span class="err">-periphery/build/IUniswapV</span><span class="mi">2</span><span class="err">Router</span><span class="mi">02</span><span class="err">.json&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="factory-1">factory</h5>
<p>返回facotry合约地址</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">factory</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="weth">WETH</h5>
<p>返回 WETH的地址,  关于WETH: <a href="https://blog.0xproject.com/canonical-weth-a9aa7d0279dd" target="_blank" rel="noopener noreffer ">https://blog.0xproject.com/canonical-weth-a9aa7d0279dd</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">WETH</span><span class="p">()</span> <span class="k">external</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="quote-getamountout-getamountin-getamountsout-getamountsin">quote getAmountOut getAmountIn getAmountsOut getAmountsIn</h5>
<p>参考 <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/library" target="_blank" rel="noopener noreffer ">Library合约</a>中的相关函数</p>
<h5 id="addliquidity">addLiquidity</h5>
<p>增加 ERC-20⇄ERC-20 池子的流动性</p>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#addliquidity" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#addliquidity</a></p>
<blockquote>
<p>调用前需要先调用IERC20的Approve为Router批准额度</p>
</blockquote>
<blockquote>
<p>Token 不能是USDT</p>
</blockquote>
<blockquote>
<p>如果对应的Pair不存在则会创建</p>
<p><a href="https://github.com/Uniswap/v2-periphery/blob/master/contracts/UniswapV2Router02.sol#L41" target="_blank" rel="noopener noreffer ">https://github.com/Uniswap/v2-periphery/blob/master/contracts/UniswapV2Router02.sol#L41</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">addLiquidity</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">address</span> <span class="n">tokenA</span><span class="p">,</span> <span class="c1">// 添加流动性 tokenA 的地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">address</span> <span class="n">tokenB</span><span class="p">,</span> <span class="c1">// 添加流动性 tokenB 的地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">amountADesired</span><span class="p">,</span> <span class="c1">// 期望添加 tokenA 的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">amountBDesired</span><span class="p">,</span> <span class="c1">// 期望添加 tokenB 的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">amountAMin</span><span class="p">,</span> <span class="c1">// 添加 tokenA 的最小数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">amountBMin</span> <span class="c1">// 添加 tokenB 的最小数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="c1">// 获得的流动性代币发送到的地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">deadline</span> <span class="c1">// 过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint</span> <span class="n">amountA</span><span class="p">,</span> <span class="c1">// 实际添加 tokenA 的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">amountB</span><span class="p">,</span> <span class="c1">// 实际添加 tokenB 的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint</span> <span class="n">liquidity</span> <span class="c1">// 获得流动性代币的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: SEE LICENSE IN LICENSE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;forge-std/Test.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install OpenZeppelin/openzeppelin-contracts --no-commit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install --no-commit  Uniswap/v2-core
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Factory.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Pair.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install --no-commit Uniswap/v2-periphery
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/v2-periphery/contracts/interfaces/IUniswapV2Router02.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">IUniswapV2Router02</span> <span class="k">constant</span> <span class="n">UNISWAP_V2_ROUTER</span> <span class="o">=</span> <span class="n">IUniswapV2Router02</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">IERC20</span> <span class="k">constant</span> <span class="n">WETH</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="mh">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">ExampleToken</span> <span class="k">is</span> <span class="n">ERC20</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">constructor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="k">memory</span> <span class="n">_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="kt">string</span> <span class="k">memory</span> <span class="n">_symbol</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="n">ERC20</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">_symbol</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint256</span> <span class="n">initSupply</span> <span class="o">=</span> <span class="mi">100000</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">_mint</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">,</span> <span class="n">initSupply</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">RouterTest</span> <span class="k">is</span> <span class="n">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ExampleToken</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">setUp</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">vm</span><span class="p">.</span><span class="n">createSelectFork</span><span class="p">(</span><span class="s">&#34;mainnet&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ExampleToken</span><span class="p">(</span><span class="s">&#34;ExampleToken&#34;</span><span class="p">,</span> <span class="s">&#34;EXT&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">deal</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">WETH</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="mi">10000</span> <span class="kc">ether</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">testAddLiquidity</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ext</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">UNISWAP_V2_ROUTER</span><span class="p">),</span> <span class="mi">10000</span> <span class="kc">ether</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">WETH</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">UNISWAP_V2_ROUTER</span><span class="p">),</span> <span class="mi">1000</span> <span class="kc">ether</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="kt">uint</span> <span class="n">amountA</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amountB</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">liquidity</span><span class="p">)</span> <span class="o">=</span> <span class="n">UNISWAP_V2_ROUTER</span>
</span></span><span class="line"><span class="cl">            <span class="p">.</span><span class="n">addLiquidity</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="kt">address</span><span class="p">(</span><span class="n">ext</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="kt">address</span><span class="p">(</span><span class="n">WETH</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="mi">10000</span> <span class="kc">ether</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="mi">1000</span> <span class="kc">ether</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span> <span class="o">+</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;amountA:&#34;</span><span class="p">,</span> <span class="n">amountA</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;amountB:&#34;</span><span class="p">,</span> <span class="n">amountB</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;liquidity:&#34;</span><span class="p">,</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">IUniswapV2Factory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">IUniswapV2Factory</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">UNISWAP_V2_ROUTER</span><span class="p">.</span><span class="n">factory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">address</span> <span class="n">pairAddress</span> <span class="o">=</span> <span class="n">factory</span><span class="p">.</span><span class="n">getPair</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">ext</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">WETH</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">IUniswapV2Pair</span> <span class="n">pair</span> <span class="o">=</span> <span class="n">IUniswapV2Pair</span><span class="p">(</span><span class="n">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;pair address:&#34;</span><span class="p">,</span> <span class="n">pairAddress</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;liquidity token i have:&#34;</span><span class="p">,</span> <span class="n">pair</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Logs:
</span></span><span class="line"><span class="cl">  amountA: 10000000000000000000000
</span></span><span class="line"><span class="cl">  amountB: 1000000000000000000000
</span></span><span class="line"><span class="cl">  liquidity: 3162277660168379330998
</span></span><span class="line"><span class="cl">  pair address: 0x35318373409608AFC0f2cdab5189B3cB28615008
</span></span><span class="line"><span class="cl">  liquidity token i have: 3162277660168379330998
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="addliquidityeth">addLiquidityETH</h5>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#addliquidityeth" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#addliquidityeth</a></p>
<p>使用ETH和Token的增加  ERC-20⇄WETH 池子的流动性</p>
<p>用法和<code>addLiquidity</code>类似, 只不是ETH是通过<code>msg.value</code>传入的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nf">addLiquidityETH</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="kt">address</span> <span class="n">token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amountTokenDesired</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amountTokenMin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">amountETHMin</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">address</span> <span class="n">to</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint</span> <span class="n">deadline</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="k">external</span> <span class="k">payable</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">amountToken</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">amountETH</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">liquidity</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="removeliquidity-removeliquidityeth">removeLiquidity removeLiquidityETH</h5>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquidity" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquidity</a></p>
<p>增加流动性的反向操作: 降低流动性 并销毁一部分流动性代币</p>
<h5 id="removeliquiditywithpermit--removeliquidityethwithpermit">removeLiquidityWithPermit  removeLiquidityETHWithPermit</h5>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquiditywithpermit" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquiditywithpermit</a></p>
<p><code>removeLiquidity</code> 和<code> removeLiquidityETH</code> 的Permit版本(无需提前Approve)</p>
<h5 id="removeliquidityethsupportingfeeontransfertokens">removeLiquidityETHSupportingFeeOnTransferTokens</h5>
<p><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquidityethsupportingfeeontransfertokens" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#removeliquidityethsupportingfeeontransfertokens</a></p>
<p><code>removeLiquidityETH</code> 的 手续费转移代币 翻版</p>
<h5 id="swap_xxx">swap_xxx</h5>
<p>由于价格时浮动的, 所以需要确定是输入固定(就花这么多钱)还是输出固定(就换这么多东西), 不行就revert</p>
<table>
<thead>
<tr>
<th>函数名称</th>
<th>输入代币类型</th>
<th>输出代币类型</th>
<th>输入数量类型</th>
<th>输出数量类型</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swapexacttokensfortokens" target="_blank" rel="noopener noreffer ">swapExactTokensForTokens</a></td>
<td>ERC20代币</td>
<td>ERC20代币</td>
<td>固定数量</td>
<td>自动计算</td>
</tr>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swaptokensforexacttokens" target="_blank" rel="noopener noreffer ">swapTokensForExactTokens</a></td>
<td>ERC20代币</td>
<td>ERC20代币</td>
<td>自动计算</td>
<td>固定数量</td>
</tr>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swapexactethfortokens" target="_blank" rel="noopener noreffer ">swapExactETHForTokens</a></td>
<td>ETH</td>
<td>ERC20代币</td>
<td>固定数量</td>
<td>自动计算</td>
</tr>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swaptokensforexacteth" target="_blank" rel="noopener noreffer ">swapTokensForExactETH</a></td>
<td>ERC20代币</td>
<td>ETH</td>
<td>自动计算</td>
<td>固定数量</td>
</tr>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swapexacttokensforeth" target="_blank" rel="noopener noreffer ">swapExactTokensForETH</a></td>
<td>ERC20代币</td>
<td>ETH</td>
<td>固定数量</td>
<td>自动计算</td>
</tr>
<tr>
<td><a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/router-02#swapethforexacttokens" target="_blank" rel="noopener noreffer ">swapETHForExactTokens</a></td>
<td>ETH</td>
<td>ERC20代币</td>
<td>自动计算</td>
<td>固定数量</td>
</tr>
</tbody>
</table>
<ul>
<li><code>deadline</code>: 每次交易都需要包含一个deadline参数，表示这个交易的截止时间。如果在截止时间之前交易成功，交易就会被执行，否则交易将被取消。deadline参数是以Unix时间戳（以秒为单位）的形式提供的。在Solidity中，可以使用<code>block.timestamp</code>获取当前区块的时间戳</li>
<li><code>path</code> : 用于指定交易从一个代币到另一个代币的路线。在使用swap函数进行交易时，需要指定交易的输入代币和输出代币，并通过路径参数指定交易路径。路径参数是一个代币地址数组，表示交易从输入代币开始，逐步转换到输出代币的过程</li>
</ul>
<blockquote>
<p>注: 在warp之前需要先Approve</p>
</blockquote>
<p>举例:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: SEE LICENSE IN LICENSE
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;forge-std/Test.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install OpenZeppelin/openzeppelin-contracts --no-commit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/openzeppelin-contracts/contracts/token/ERC20/ERC20.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install --no-commit  Uniswap/v2-core
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Factory.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;lib/v2-core/contracts/interfaces/IUniswapV2Pair.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// forge install --no-commit Uniswap/v2-periphery
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;lib/v2-periphery/contracts/interfaces/IUniswapV2Router02.sol&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">IUniswapV2Router02</span> <span class="k">constant</span> <span class="n">UNISWAP_V2_ROUTER</span> <span class="o">=</span> <span class="n">IUniswapV2Router02</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="mh">0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">RouterTest</span> <span class="k">is</span> <span class="n">Test</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">setUp</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">vm</span><span class="p">.</span><span class="n">createSelectFork</span><span class="p">(</span><span class="s">&#34;mainnet&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">testSwap</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">IERC20</span> <span class="n">DAI</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="mh">0x6B175474E89094C44Da98b954EedeAC495271d0F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">IERC20</span> <span class="n">USDC</span> <span class="o">=</span> <span class="n">IERC20</span><span class="p">(</span><span class="mh">0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">deal</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">DAI</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="mi">10000</span> <span class="kc">ether</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">DAI</span><span class="p">.</span><span class="n">approve</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">UNISWAP_V2_ROUTER</span><span class="p">),</span> <span class="mi">10000</span> <span class="kc">ether</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">address</span><span class="p">[](</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">DAI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="n">USDC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">uint</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">amounts</span> <span class="o">=</span> <span class="n">UNISWAP_V2_ROUTER</span><span class="p">.</span><span class="n">swapExactTokensForTokens</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="mi">10000</span> <span class="kc">ether</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="nb">block</span><span class="p">.</span><span class="nb">timestamp</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;amounts[0]:&#34;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;amounts[1]:&#34;</span><span class="p">,</span> <span class="n">amounts</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="n">console2</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#34;USDC i have&#34;</span><span class="p">,</span> <span class="n">USDC</span><span class="p">.</span><span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Logs:
</span></span><span class="line"><span class="cl">  amounts[0]: 10000000000000000000000
</span></span><span class="line"><span class="cl">  amounts[1]: 9963991331
</span></span><span class="line"><span class="cl">  USDC i have 9963991331
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="swap_xxx_fortokenssupportingfeeontransfertokens">swap_xxx_ForTokensSupportingFeeOnTransferTokens</h5>
<p>swap_xxx的手续费转移翻版</p>
<h4 id="library">Library</h4>
<p>参考这 <a href="https://docs.uniswap.org/contracts/v2/reference/smart-contracts/library" target="_blank" rel="noopener noreffer ">https://docs.uniswap.org/contracts/v2/reference/smart-contracts/library</a></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-03-13</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/uniswap/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://yinhui1984.github.io/uniswap/" data-title="Uniswap" data-hashtags="swap,L3,Web3.0"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://yinhui1984.github.io/uniswap/" data-hashtag="swap"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://yinhui1984.github.io/uniswap/" data-title="Uniswap"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://yinhui1984.github.io/uniswap/" data-title="Uniswap"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://yinhui1984.github.io/uniswap/" data-title="Uniswap"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/swap/">swap</a>,&nbsp;<a href="/tags/l3/">L3</a>,&nbsp;<a href="/tags/web3.0/">Web3.0</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/analyse_of_egd_finance_attack/" class="prev" rel="prev" title="EGD Finance 价格操纵攻击事件分析"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>EGD Finance 价格操纵攻击事件分析</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.110.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/yinhui1984" target="_blank">zhouyinhui</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":200},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
