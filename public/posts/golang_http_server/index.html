<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Golang]Http Server | Zhouyinhui's Space</title><meta name=keywords content="#go#,#golang#"><meta name=description content="简单的文件服务器 package main  import ( 	&#34;log&#34; 	&#34;net/http&#34; )  func main() { 	err := http.ListenAndServe(&#34;:8080&#34;, http.FileServer(http.Dir(&#34;.&#34;))) 	if err != nil { 	log.Fatal(err) 	} } 上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.
然后写一个函数放到bash.rc 或zshrc中
#文件服务器 function fileserver(){ 	echo &#34;start file server :12345&#34; 	cat <<EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.go package main import ( &#34;log&#34; &#34;net/http&#34; ) func main() { err := http.ListenAndServe(&#34;:12345&#34;, http.FileServer(http.Dir(&#34;.&#34;))) if err !"><meta name=author content="zhouyinhui"><link rel=canonical href=../../posts/golang_http_server/><link crossorigin=anonymous href=../../assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=../../assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.95.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[Golang]Http Server"><meta property="og:description" content="简单的文件服务器 package main  import ( 	&#34;log&#34; 	&#34;net/http&#34; )  func main() { 	err := http.ListenAndServe(&#34;:8080&#34;, http.FileServer(http.Dir(&#34;.&#34;))) 	if err != nil { 	log.Fatal(err) 	} } 上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.
然后写一个函数放到bash.rc 或zshrc中
#文件服务器 function fileserver(){ 	echo &#34;start file server :12345&#34; 	cat <<EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.go package main import ( &#34;log&#34; &#34;net/http&#34; ) func main() { err := http.ListenAndServe(&#34;:12345&#34;, http.FileServer(http.Dir(&#34;.&#34;))) if err !"><meta property="og:type" content="article"><meta property="og:url" content="/posts/golang_http_server/"><meta property="og:image" content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-06T10:04:12+08:00"><meta property="article:modified_time" content="2022-06-06T10:04:12+08:00"><meta property="og:site_name" content="zhouyinhui's blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="[Golang]Http Server"><meta name=twitter:description content="简单的文件服务器 package main  import ( 	&#34;log&#34; 	&#34;net/http&#34; )  func main() { 	err := http.ListenAndServe(&#34;:8080&#34;, http.FileServer(http.Dir(&#34;.&#34;))) 	if err != nil { 	log.Fatal(err) 	} } 上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.
然后写一个函数放到bash.rc 或zshrc中
#文件服务器 function fileserver(){ 	echo &#34;start file server :12345&#34; 	cat <<EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.go package main import ( &#34;log&#34; &#34;net/http&#34; ) func main() { err := http.ListenAndServe(&#34;:12345&#34;, http.FileServer(http.Dir(&#34;.&#34;))) if err !"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"/posts/"},{"@type":"ListItem","position":3,"name":"[Golang]Http Server","item":"/posts/golang_http_server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Golang]Http Server","name":"[Golang]Http Server","description":"简单的文件服务器 package main  import ( \t\u0026#34;log\u0026#34; \t\u0026#34;net/http\u0026#34; )  func main() { \terr := http.ListenAndServe(\u0026#34;:8080\u0026#34;, http.FileServer(http.Dir(\u0026#34;.\u0026#34;))) \tif err != nil { \tlog.Fatal(err) \t} } 上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.\n然后写一个函数放到bash.rc 或zshrc中\n#文件服务器 function fileserver(){ \techo \u0026#34;start file server :12345\u0026#34; \tcat \u0026lt;\u0026lt;EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.go package main import ( \u0026#34;log\u0026#34; \u0026#34;net/http\u0026#34; ) func main() { err := http.ListenAndServe(\u0026#34;:12345\u0026#34;, http.FileServer(http.Dir(\u0026#34;.\u0026#34;))) if err !","keywords":["#go#","#golang#"],"articleBody":"简单的文件服务器 package main  import ( \t\"log\" \t\"net/http\" )  func main() { \terr := http.ListenAndServe(\":8080\", http.FileServer(http.Dir(\".\"))) \tif err != nil { \tlog.Fatal(err) \t} } 上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.\n然后写一个函数放到bash.rc 或zshrc中\n#文件服务器 function fileserver(){ \techo \"start file server :12345\" \tcat package main import ( \"log\" \"net/http\" ) func main() { err := http.ListenAndServe(\":12345\", http.FileServer(http.Dir(\".\"))) if err != nil { log.Fatal(err) } } EOF } OSX MP16 ~/Downloads ❯ fileserver start file server :12345 Python中有相同的功能\npython3 -m SimpleHTTPServer 7777 或 python3 -m http.server\n一个简单的WebServer package main  import ( \t\"log\" \t\"net/http\" )  func main() {  \thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { \t_, err := w.Write([]byte(\"Hello World!\\n\")) \tif err != nil { \tlog.Println(err) \t} \t})  \terr := http.ListenAndServe(\":12345\", nil) \tif err != nil { \tlog.Fatal(err) \t} } 访问一下试试:\nOSX MP16 ~/Downloads/goplayground ❯ curl http://localhost:12345 Hello World! http.HandleFunc http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { \t//... \t}) 该方法提供了一种指定如何处理特定路由的请求的方法, 第一个参数为路由, 第二个参数为处理函数. 处理函数可写成匿名函数, 也可以声明为一个独立的函数\nfunc rootHandler(w http.ResponseWriter, r *http.Request) { \t_, err := w.Write([]byte(\"Hello World\")) \tif err != nil { \tlog.Println(err) \t} }  func main() {  \thttp.HandleFunc(\"/\", rootHandler)  //... } 函数的第一个参数是http.ResponseWriter类型的值。这是用于向任何连接的HTTP客户端发送响应的机制。这也是响应标头的设置方式,比如w.WriteHeader(http.StatusOK)。第二个论点是指向http.Request的指针。这是从网络请求中检索数据的方式。例如，可以通过请求指针访问表单提交的详细信息\n比如 下面的方法, 使用 http://127.0.0.1:12345/?key=date 时将返回当前的日期, 确实key=或key不正确时返回http.StatusBadRequest\nfunc rootHandler(w http.ResponseWriter, r *http.Request) { \tkeys, ok := r.URL.Query()[\"key\"] \tif !ok || len(keys[0]) 1 { \tlog.Println(\"Url Param 'key' is missing\") \tw.WriteHeader(http.StatusBadRequest) \t_, err := w.Write([]byte(\"Url Param 'key' is missing\")) \tif err != nil { \tlog.Println(err) \treturn \t} \treturn \t}  \tkey := keys[0] \tswitch key { \tcase \"date\": \tw.WriteHeader(http.StatusOK) \t_, err := w.Write([]byte(time.Now().Format(\"2006-01-02\"))) \tif err != nil { \tlog.Println(err) \t} \tdefault: \tw.WriteHeader(http.StatusBadRequest) \t_, _ = w.Write([]byte(\"Invalid key\")) \tlog.Println(\"Invalid key\") \t} } http.ResponseWriter 用于向任何连接的HTTP客户端发送响应\n设置相应标志头: w.WriteHeader(http.StatusOK) 获取或实则响应头 w.Header().Set(\"content-type\", \"application/json\") w.Header().Add(\"foo\", \"bar\") 写入相应数据: w.Write([]byte(time.Now().Format(\"2006-01-02\"))) 例子:\npackage main  import ( \t\"encoding/json\" \t\"log\" \t\"net/http\" )  type SystemInfo struct { \tHostname string `json:\"hostname\"` \tUptime string `json:\"uptime\"` }  func rootHandler(w http.ResponseWriter, r *http.Request) { \tinfo := SystemInfo{ \tHostname: \"test\", \tUptime: \"2022-01-01 00:00:00\", \t} \tw.Header().Set(\"Content-Type\", \"application/json\") \tw.WriteHeader(http.StatusOK) \tbytes, _ := json.Marshal(info) \t_, err := w.Write(bytes) \tif err != nil { \tlog.Println(\"Error writing response: \", err) \t} }  func main() {  \thttp.HandleFunc(\"/\", rootHandler)  \terr := http.ListenAndServe(\":12345\", nil) \tif err != nil { \tlog.Fatal(err) \t} } OSX MP16 ~ ❯ curl localhost:12345 {\"hostname\":\"test\",\"uptime\":\"2022-01-01 00:00:00\"} *http.Request 指向http.Request的指针, 通过改指针可以获取请求中的各种数据, 比如\n获取基本信息 func rootHandler(w http.ResponseWriter, r *http.Request) {  \tfmt.Println(\"User Agent: \", r.UserAgent()) \tfmt.Println(\"Host: \", r.Host) \tfmt.Println(\"Remote Address: \", r.RemoteAddr) \tfmt.Println(\"Request URI: \", r.RequestURI) \tfmt.Println(\"Method: \", r.Method) \tfmt.Println(\"URL: \", r.URL) \tfmt.Println(\"Header: \", r.Header)  \tw.WriteHeader(http.StatusOK) } 输出:\nUser Agent: curl/7.79.1 Host: localhost:12345 Remote Address: 127.0.0.1:58967 Request URI: / Method: GET URL: / Header: map[Accept:[*/*] User-Agent:[curl/7.79.1]] 获取cookie func rootHandler(w http.ResponseWriter, r *http.Request) {  \t//获取所有 \tfor _, c := range r.Cookies() { \tfmt.Printf(\"%s : %q\\n\", c.Name, c.Value) \t}  \t//获取指定 \tc, err := r.Cookie(\"token\") \tif err != nil { \tlog.Println(err) \t} \tfmt.Printf(\"%s : %q\\n\", c.Name, c.Value)  \tw.WriteHeader(http.StatusOK) } curl --cookie \"token=abcdefg\" http://localhost:12345\n获取GET参数   获取所有参数 args := r.URL.Query()\n  获取指定参数(注:参数可能被重复写多次)\n比如: localhost:12345/?id=5\nfunc rootHandler(w http.ResponseWriter, r *http.Request) { \tids, ok := r.URL.Query()[\"id\"] \tif !ok || len(ids[0]) 1 { \tlog.Println(\"Url Param 'id' is missing\") \treturn \t} \tid := ids[0] \tlog.Println(\"Url Param 'id' is: \" + id)  \tw.WriteHeader(http.StatusOK) }   或者\nfunc rootHandler(w http.ResponseWriter, r *http.Request) {  \tid := r.FormValue(\"id\") \tif id == \"\" { \tlog.Println(\"Url Param 'id' is missing\") \t} \tfmt.Println(\"id:\", id)  \tw.WriteHeader(http.StatusOK) }  也可以通过r.Form来获取Get参数\n 获取PATCH, POST or PUT参数 比如 curl -d \"id=5\u0026format=1\" http://localhost:12345/\nfunc rootHandler(w http.ResponseWriter, r *http.Request) { \t//parse \terr := r.ParseForm() \tif err != nil { \tlog.Println(\"ParseForm error:\", err) \t} \t//get post args \tfor k, v := range r.PostForm { \tlog.Println(\"key:\", k) \tlog.Println(\"val:\", v) // v []string \t}  \tw.WriteHeader(http.StatusOK) } 输出\n2022/06/06 15:14:46 key: id 2022/06/06 15:14:46 val: [5] 2022/06/06 15:14:46 key: format 2022/06/06 15:14:46 val: [1] ParseForm会填充r.Form和r.PostForm。 对于所有的请求，ParseForm解析来自URL的原始查询并更新r.Form。 对于POST、PUT和PATCH请求，它也读取请求正文，将其解析为一个表单，并将结果放入r.PostForm和r.Form中。在r.Form中，请求正文参数优先于URL查询字符串值。 如果请求体的大小还没有被MaxBytesReader限制，那么其大小将被限制在10MB。 对于其他HTTP方法，或者当内容类型不是application/x-www-form-urlencoded时，请求正文不被读取，并且r.PostForm被初始化为一个非零的空值。 ParseMultipartForm自动调用ParseForm。ParseForm是幂等的。\n r.Form属性包含了post表单和url中的get参数。\nr.PostForm属性只包含了post表单参数。\n 获取指定参数, 比如\nfunc rootHandler(w http.ResponseWriter, r *http.Request) {  \terr := r.ParseForm() \tif err != nil { \tlog.Println(\"ParseForm error:\", err) \t} \tids := r.PostForm.Get(\"id\") //获取id参数的第一个值 \tlog.Println(\"id:\", ids)  \tw.WriteHeader(http.StatusOK) } 或者\nfunc rootHandler(w http.ResponseWriter, r *http.Request) {  \tid := r.PostFormValue(\"id\") \tif id == \"\" { \tlog.Println(\"Url Param 'id' is missing\") \t} \tfmt.Println(\"id:\", id)  \tw.WriteHeader(http.StatusOK) } 获取上传文件 比如 curl -F \"file=@IMG_1526.PNG;type=image/png\" http://localhost:12345/upload\n下面代码中:\nr.ParseMultipartForm(10 将一个请求体解析为multipart/form-data。整个请求正文被解析，并且其文件部分最多存储在maxMemory字节的内存中，其余部分则存储在磁盘的临时文件中。ParseMultipartForm在必要时调用ParseForm。如果ParseForm返回一个错误，ParseMultipartForm将其返回，但也继续解析请求正文。在对ParseMultipartForm进行一次调用后，随后的调用没有任何影响.\nFormFile 返回提供的表单key的第一个文件。如果需要，FormFile会调用ParseMultipartForm和ParseForm。\npackage main  import ( \t\"io\" \t\"log\" \t\"mime/multipart\" \t\"net/http\" \t\"os\" )  func uploadHandler(w http.ResponseWriter, r *http.Request) {  \t// Parse the multipart form in the request \terr := r.ParseMultipartForm(10  20) // 10 MiB \tif err != nil { \thttp.Error(w, err.Error(), http.StatusInternalServerError) \treturn \t} \t\t\t// FormFile returns the first file for the given key `file` \t// it also returns the FileHeader, so we can get the Filename, the Header and the size of the file \tfile, handler, err := r.FormFile(\"file\") \tif err != nil { \thttp.Error(w, err.Error(), http.StatusInternalServerError) \treturn \t} \tdefer func(file multipart.File) { \terr := file.Close() \tif err != nil { \tlog.Println(err) \t} \t}(file) \terr = os.MkdirAll(\"./upload\", 0777) \tif err != nil { \thttp.Error(w, err.Error(), http.StatusInternalServerError) \treturn \t} \tlocalFile, err := os.OpenFile(\"./upload/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666) \tif err != nil { \thttp.Error(w, err.Error(), http.StatusInternalServerError) \treturn \t} \tdefer func(localFile *os.File) { \terr := localFile.Close() \tif err != nil { \tlog.Println(err) \t} \t}(localFile) \t_, err = io.Copy(localFile, file) \tif err != nil { \thttp.Error(w, \"\", http.StatusInternalServerError)  return \t}  \tw.WriteHeader(http.StatusOK) }  func main() {  \thttp.HandleFunc(\"/upload\", uploadHandler)  \terr := http.ListenAndServe(\":12345\", nil) \tif err != nil { \tlog.Fatal(err) \t} } 👍各种获取参数方式比较    操作 解析 读取URL参数 读取Body表单 支持文本 支持二进制     r.Form r.ParseForm() Y Y Y    r.PostForm r.ParseForm()  Y Y    r.FormValue() 自动调用r.ParseForm() Y Y Y    r.PostFormValue() 自动调用r.ParseForm()  Y Y    r.MultipartForm ParseMultipartForm()  Y Y Y   r.FormFile 自动调用ParseMultipartForm()  Y  Y    Handler , Handle , HandleFunc 与 http.ListenAndServe 使用默认的Handler 先看一个简单的例子\npackage main  import \"net/http\"  func main() { \thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) { \tw.Write([]byte(\"Hello, world!\")) \t}) \thttp.HandleFunc(\"/blog\", func(w http.ResponseWriter, r *http.Request) { \tw.Write([]byte(\"This is my Blog\")) \t})  \thttp.ListenAndServe(\":12345\", nil) } 在启动一个HttpServer的时候, 其实我们就关心2个东西:\n 地址 路由: 将请求对应到相应的处理函数中去  这两个参数 在http.ListenAndServe(\":12345\", nil)中进行设置的, 第一个为地址, 第二个传递处理函数.\n如果传递nil, 则采用默认的\n The handler is typically nil, in which case the DefaultServeMux is used.\n http.ListenAndServe的实现如下:\nfunc ListenAndServe(addr string, handler Handler) error { \tserver := \u0026Server{Addr: addr, Handler: handler} \treturn server.ListenAndServe() } type Handler interface {  ServeHTTP(ResponseWriter, *Request) } 可以看到 Handler是一个接口, 实现这个接口的话, 我们可以创建自己的Handler\n自定义Handler 定义一个结构体, 结构体实现 ServeHTTP(w http.ResponseWriter, r *http.Request)方法\n然后使用 Handle函数进行路由注册\npackage main  import \"net/http\"  type MyIndexHandler struct { }  func (h *MyIndexHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { \tw.Write([]byte(\"Hello World\")) }  type MyBlogHandler struct { }  func (h *MyBlogHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) { \tw.Write([]byte(\"This is my Blog\")) }  func main() { \tmux := http.NewServeMux() \tmux.Handle(\"/\", \u0026MyIndexHandler{}) \tmux.Handle(\"/blog\", \u0026MyBlogHandler{}) \thttp.ListenAndServe(\":12345\", mux) } OSX MP16 ~ ❯ curl localhost:12345 Hello World OSX MP16 ~ ❯ curl localhost:12345/blog This is my Blog OSX MP16 ~ ❯ 但这明显看出来, 对每一个路由 都要高写一个xxxHandler结构体和实现ServeHTTP, 看上去非常混乱\n这时候就可以用mux.HandleFunc来实现路由\npackage main  import \"net/http\"  func main() {  mux := http.NewServeMux()  mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {  w.Write([]byte(\"Hello World\"))  })  mux.HandleFunc(\"/blog\", func(w http.ResponseWriter, r *http.Request) {  w.Write([]byte(\"This is my Blog\"))  })   http.ListenAndServe(\":12345\", mux) } 自定义ServeMux 在上面的例子中, mux := http.NewServeMux()还是使用了默认router, 其简单的同时也有不少缺点\n比如, 其是通过url进行路由, 但不支持基于方法(GET, POST…)的路由, 不支持正则表达式等等\n参考这个 https://www.alexedwards.net/blog/which-go-router-should-i-use\n人气Web框架 参考这篇文章,\nhttps://blog.51cto.com/coderaction/3001008\n其中有各框架的对比, 功能上iris最全\nhttps://github.com/kataras/iris\n","wordCount":"1105","inLanguage":"en","datePublished":"2022-06-06T10:04:12+08:00","dateModified":"2022-06-06T10:04:12+08:00","author":{"@type":"Person","name":"zhouyinhui"},"mainEntityOfPage":{"@type":"WebPage","@id":"/posts/golang_http_server/"},"publisher":{"@type":"Organization","name":"Zhouyinhui's Space","logo":{"@type":"ImageObject","url":"%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href accesskey=h title="Zhouyinhui's Space (Alt + H)">Zhouyinhui's Space</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=../../ title=home><span>home</span></a></li><li><a href=../../tags/ title=tags><span>tags</span></a></li><li><a href=../../archives/ title=archives><span>archives</span></a></li><li><a href=../../search/ title="🔍search (Alt + /)" accesskey=/><span>🔍search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href>Home</a>&nbsp;»&nbsp;<a href=../../posts/>Posts</a></div><h1 class=post-title>[Golang]Http Server</h1><div class=post-meta><span title="2022-06-06 10:04:12 +0800 CST">June 6, 2022</span>&nbsp;·&nbsp;zhouyinhui</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%ae%80%e5%8d%95%e7%9a%84%e6%96%87%e4%bb%b6%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=简单的文件服务器>简单的文件服务器</a></li><li><a href=#%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84webserver aria-label=一个简单的WebServer>一个简单的WebServer</a></li><li><a href=#httphandlefunc aria-label=http.HandleFunc>http.HandleFunc</a><ul><li><a href=#httpresponsewriter aria-label=http.ResponseWriter>http.ResponseWriter</a><ul><li><a href=#%e8%ae%be%e7%bd%ae%e7%9b%b8%e5%ba%94%e6%a0%87%e5%bf%97%e5%a4%b4 aria-label=设置相应标志头:>设置相应标志头:</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e6%88%96%e5%ae%9e%e5%88%99%e5%93%8d%e5%ba%94%e5%a4%b4 aria-label=获取或实则响应头>获取或实则响应头</a></li><li><a href=#%e5%86%99%e5%85%a5%e7%9b%b8%e5%ba%94%e6%95%b0%e6%8d%ae aria-label=写入相应数据:>写入相应数据:</a></li></ul></li><li><a href=#httprequest aria-label=*http.Request>*http.Request</a><ul><li><a href=#%e8%8e%b7%e5%8f%96%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af aria-label=获取基本信息>获取基本信息</a></li><li><a href=#%e8%8e%b7%e5%8f%96cookie aria-label=获取cookie>获取cookie</a></li><li><a href=#%e8%8e%b7%e5%8f%96get%e5%8f%82%e6%95%b0 aria-label=获取GET参数>获取GET参数</a></li><li><a href=#%e8%8e%b7%e5%8f%96patch-post-or-put%e5%8f%82%e6%95%b0 aria-label="获取PATCH, POST or PUT参数">获取PATCH, POST or PUT参数</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6 aria-label=获取上传文件>获取上传文件</a></li><li><a href=#%e5%90%84%e7%a7%8d%e8%8e%b7%e5%8f%96%e5%8f%82%e6%95%b0%e6%96%b9%e5%bc%8f%e6%af%94%e8%be%83 aria-label=👍各种获取参数方式比较>👍各种获取参数方式比较</a></li></ul></li><li><a href=#handler--handle--handlefunc-%e4%b8%8e-httplistenandserve aria-label="Handler , Handle , HandleFunc 与 http.ListenAndServe">Handler , Handle , HandleFunc 与 http.ListenAndServe</a><ul><li><a href=#%e4%bd%bf%e7%94%a8%e9%bb%98%e8%ae%a4%e7%9a%84handler aria-label=使用默认的Handler>使用默认的Handler</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89handler aria-label=自定义Handler>自定义Handler</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89servemux aria-label=自定义ServeMux>自定义ServeMux</a></li></ul></li></ul></li><li><a href=#%e4%ba%ba%e6%b0%94web%e6%a1%86%e6%9e%b6 aria-label=人气Web框架>人气Web框架</a></li></ul></div></details></div><div class=post-content><h2 id=简单的文件服务器>简单的文件服务器<a hidden class=anchor aria-hidden=true href=#简单的文件服务器>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>FileServer</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Dir</span>(<span style=color:#e6db74>&#34;.&#34;</span>)))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>上面这个例子创建了一个以当前目录为站点跟目录的文件服务器, 我一般用这个来作为局域网文件共享.</p><p>然后写一个函数放到bash.rc 或zshrc中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e>#文件服务器</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> fileserver<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>	echo <span style=color:#e6db74>&#34;start file server :12345&#34;</span>
</span></span><span style=display:flex><span>	cat <span style=color:#e6db74>&lt;&lt;EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.go
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>package main
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>import (
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&#34;log&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	&#34;net/http&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>func main() {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	err := http.ListenAndServe(&#34;:12345&#34;, http.FileServer(http.Dir(&#34;.&#34;)))
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	if err != nil {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>		log.Fatal(err)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>	}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>OSX MP16 ~/Downloads ❯ fileserver                                                         
</span></span><span style=display:flex><span>start file server :12345
</span></span></code></pre></div><p>Python中有相同的功能</p><p><code>python3 -m SimpleHTTPServer 7777</code> 或 <code>python3 -m http.server</code></p><h2 id=一个简单的webserver>一个简单的WebServer<a hidden class=anchor aria-hidden=true href=#一个简单的webserver>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Hello World!\n&#34;</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>访问一下试试:</p><pre tabindex=0><code>OSX MP16 ~/Downloads/goplayground ❯ curl http://localhost:12345          
Hello World!
</code></pre><h2 id=httphandlefunc>http.HandleFunc<a hidden class=anchor aria-hidden=true href=#httphandlefunc>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	})
</span></span></code></pre></div><p>该方法提供了一种指定如何处理特定路由的请求的方法, 第一个参数为路由, 第二个参数为处理函数. 处理函数可写成匿名函数, 也可以声明为一个独立的函数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;&lt;h1 style=\&#34;color:Tomato;\&#34;&gt;Hello World&lt;/h1&gt;&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#a6e22e>rootHandler</span>)
</span></span><span style=display:flex><span>  <span style=color:#75715e>//...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>函数的第一个参数是<code>http.ResponseWriter</code>类型的值。这是用于向任何连接的HTTP客户端发送响应的机制。这也是响应标头的设置方式,比如<code>w.WriteHeader(http.StatusOK)</code>。第二个论点是指向<code>http.Request</code>的指针。这是从网络请求中检索数据的方式。例如，可以通过请求指针访问表单提交的详细信息</p><p>比如 下面的方法, 使用 <code>http://127.0.0.1:12345/?key=date</code> 时将返回当前的日期, 确实<code>key=</code>或<code>key</code>不正确时返回<code>http.StatusBadRequest</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>keys</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>()[<span style=color:#e6db74>&#34;key&#34;</span>]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>keys</span>[<span style=color:#ae81ff>0</span>]) &lt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Url Param &#39;key&#39; is missing&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Url Param &#39;key&#39; is missing&#34;</span>))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>key</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>keys</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>key</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;date&#34;</span>:
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02&#34;</span>)))
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusBadRequest</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Invalid key&#34;</span>))
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Invalid key&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=httpresponsewriter>http.ResponseWriter<a hidden class=anchor aria-hidden=true href=#httpresponsewriter>#</a></h3><p>用于向任何连接的HTTP客户端发送响应</p><h4 id=设置相应标志头>设置相应标志头:<a hidden class=anchor aria-hidden=true href=#设置相应标志头>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span></code></pre></div><h4 id=获取或实则响应头>获取或实则响应头<a hidden class=anchor aria-hidden=true href=#获取或实则响应头>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;content-type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Add</span>(<span style=color:#e6db74>&#34;foo&#34;</span>, <span style=color:#e6db74>&#34;bar&#34;</span>)
</span></span></code></pre></div><h4 id=写入相应数据>写入相应数据:<a hidden class=anchor aria-hidden=true href=#写入相应数据>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02&#34;</span>)))
</span></span></code></pre></div><p>例子:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>SystemInfo</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Hostname</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;hostname&#34;`</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Uptime</span>   <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;uptime&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>info</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>SystemInfo</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Hostname</span>: <span style=color:#e6db74>&#34;test&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>Uptime</span>:   <span style=color:#e6db74>&#34;2022-01-01 00:00:00&#34;</span>,
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;application/json&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>bytes</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Marshal</span>(<span style=color:#a6e22e>info</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>bytes</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Error writing response: &#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#a6e22e>rootHandler</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>OSX MP16 ~ ❯ curl localhost:12345                                                         
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;hostname&#34;</span>:<span style=color:#e6db74>&#34;test&#34;</span>,<span style=color:#e6db74>&#34;uptime&#34;</span>:<span style=color:#e6db74>&#34;2022-01-01 00:00:00&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=httprequest>*http.Request<a hidden class=anchor aria-hidden=true href=#httprequest>#</a></h3><p>指向<code>http.Request</code>的指针, 通过改指针可以获取请求中的各种数据, 比如</p><h4 id=获取基本信息>获取基本信息<a hidden class=anchor aria-hidden=true href=#获取基本信息>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;User Agent: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>UserAgent</span>())
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Host: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Host</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Remote Address: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RemoteAddr</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Request URI: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>RequestURI</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Method: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Method</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;URL: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Header: &#34;</span>, <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Header</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>User Agent:  curl/7.79.1
</span></span><span style=display:flex><span>Host:  localhost:12345
</span></span><span style=display:flex><span>Remote Address:  127.0.0.1:58967
</span></span><span style=display:flex><span>Request URI:  /
</span></span><span style=display:flex><span>Method:  GET
</span></span><span style=display:flex><span>URL:  /
</span></span><span style=display:flex><span>Header:  map<span style=color:#f92672>[</span>Accept:<span style=color:#f92672>[</span>*/*<span style=color:#f92672>]</span> User-Agent:<span style=color:#f92672>[</span>curl/7.79.1<span style=color:#f92672>]]</span>
</span></span></code></pre></div><h4 id=获取cookie>获取cookie<a hidden class=anchor aria-hidden=true href=#获取cookie>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取所有
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Cookies</span>() {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s : %q\n&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>//获取指定
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>c</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Cookie</span>(<span style=color:#e6db74>&#34;token&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%s : %q\n&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Name</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Value</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>curl --cookie "token=abcdefg" http://localhost:12345</code></p><h4 id=获取get参数>获取GET参数<a hidden class=anchor aria-hidden=true href=#获取get参数>#</a></h4><ul><li><p>获取所有参数 <code>args := r.URL.Query()</code></p></li><li><p>获取指定参数(注:参数可能被重复写多次)</p><p>比如: <code>localhost:12345/?id=5</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ids</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>Query</span>()[<span style=color:#e6db74>&#34;id&#34;</span>]
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>ids</span>[<span style=color:#ae81ff>0</span>]) &lt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Url Param &#39;id&#39; is missing&#34;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>id</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ids</span>[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Url Param &#39;id&#39; is: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ul><p>或者</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>id</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>FormValue</span>(<span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Url Param &#39;id&#39; is missing&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;id:&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>也可以通过r.Form来获取Get参数</p></blockquote><h4 id=获取patch-post-or-put参数>获取PATCH, POST or PUT参数<a hidden class=anchor aria-hidden=true href=#获取patch-post-or-put参数>#</a></h4><p>比如 <code>curl -d "id=5&format=1" http://localhost:12345/</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>//parse
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ParseForm</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ParseForm error:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>//get post args
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>PostForm</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;key:&#34;</span>, <span style=color:#a6e22e>k</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;val:&#34;</span>, <span style=color:#a6e22e>v</span>) <span style=color:#75715e>// v []string
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>输出</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>2022/06/06 15:14:46 key: id
</span></span><span style=display:flex><span>2022/06/06 15:14:46 val: <span style=color:#f92672>[</span>5<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>2022/06/06 15:14:46 key: format
</span></span><span style=display:flex><span>2022/06/06 15:14:46 val: <span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>ParseForm会填充r.Form和r.PostForm。
对于所有的请求，ParseForm解析来自URL的原始查询并更新r.Form。
对于POST、PUT和PATCH请求，它也读取请求正文，将其解析为一个表单，并将结果放入r.PostForm和r.Form中。在r.Form中，请求正文参数优先于URL查询字符串值。
如果请求体的大小还没有被MaxBytesReader限制，那么其大小将被限制在10MB。
对于其他HTTP方法，或者当内容类型不是application/x-www-form-urlencoded时，请求正文不被读取，并且r.PostForm被初始化为一个非零的空值。
ParseMultipartForm自动调用ParseForm。ParseForm是幂等的。</p><blockquote><p>r.Form属性包含了post表单和url中的get参数。</p><p>r.PostForm属性只包含了post表单参数。</p></blockquote><p>获取指定参数, 比如</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ParseForm</span>()
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;ParseForm error:&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ids</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>PostForm</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;id&#34;</span>) <span style=color:#75715e>//获取id参数的第一个值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;id:&#34;</span>, <span style=color:#a6e22e>ids</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>或者</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>id</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>PostFormValue</span>(<span style=color:#e6db74>&#34;id&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>id</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Url Param &#39;id&#39; is missing&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;id:&#34;</span>, <span style=color:#a6e22e>id</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=获取上传文件>获取上传文件<a hidden class=anchor aria-hidden=true href=#获取上传文件>#</a></h4><p>比如 <code>curl -F "file=@IMG_1526.PNG;type=image/png" http://localhost:12345/upload</code></p><p>下面代码中:</p><p><code>r.ParseMultipartForm(10 &lt;&lt; 20)</code>将一个请求体解析为multipart/form-data。整个请求正文被解析，并且其文件部分最多存储在maxMemory字节的内存中，其余部分则存储在磁盘的临时文件中。ParseMultipartForm在必要时调用ParseForm。如果ParseForm返回一个错误，ParseMultipartForm将其返回，但也继续解析请求正文。在对ParseMultipartForm进行一次调用后，随后的调用没有任何影响.</p><p><code>FormFile</code> 返回提供的表单key的第一个文件。如果需要，FormFile会调用ParseMultipartForm和ParseForm。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;mime/multipart&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>uploadHandler</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Parse the multipart form in the request
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>ParseMultipartForm</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>20</span>) <span style=color:#75715e>// 10 MiB
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// FormFile returns the first file for the given key `file`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// it also returns the FileHeader, so we can get the Filename, the Header and the size of the file
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>handler</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>FormFile</span>(<span style=color:#e6db74>&#34;file&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>file</span> <span style=color:#a6e22e>multipart</span>.<span style=color:#a6e22e>File</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}(<span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>MkdirAll</span>(<span style=color:#e6db74>&#34;./upload&#34;</span>, <span style=color:#ae81ff>0777</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>localFile</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>OpenFile</span>(<span style=color:#e6db74>&#34;./upload/&#34;</span><span style=color:#f92672>+</span><span style=color:#a6e22e>handler</span>.<span style=color:#a6e22e>Filename</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_WRONLY</span>|<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_CREATE</span>, <span style=color:#ae81ff>0666</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>(), <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>defer</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>localFile</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>File</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>localFile</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}(<span style=color:#a6e22e>localFile</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Copy</span>(<span style=color:#a6e22e>localFile</span>, <span style=color:#a6e22e>file</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteHeader</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/upload&#34;</span>, <span style=color:#a6e22e>uploadHandler</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=各种获取参数方式比较>👍各种获取参数方式比较<a hidden class=anchor aria-hidden=true href=#各种获取参数方式比较>#</a></h4><table><thead><tr><th>操作</th><th>解析</th><th>读取URL参数</th><th>读取Body表单</th><th>支持文本</th><th>支持二进制</th></tr></thead><tbody><tr><td>r.Form</td><td>r.ParseForm()</td><td>Y</td><td>Y</td><td>Y</td><td></td></tr><tr><td>r.PostForm</td><td>r.ParseForm()</td><td></td><td>Y</td><td>Y</td><td></td></tr><tr><td>r.FormValue()</td><td>自动调用r.ParseForm()</td><td>Y</td><td>Y</td><td>Y</td><td></td></tr><tr><td>r.PostFormValue()</td><td>自动调用r.ParseForm()</td><td></td><td>Y</td><td>Y</td><td></td></tr><tr><td>r.MultipartForm</td><td>ParseMultipartForm()</td><td></td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>r.FormFile</td><td>自动调用ParseMultipartForm()</td><td></td><td>Y</td><td></td><td>Y</td></tr></tbody></table><h3 id=handler--handle--handlefunc-与-httplistenandserve>Handler , Handle , HandleFunc 与 http.ListenAndServe<a hidden class=anchor aria-hidden=true href=#handler--handle--handlefunc-与-httplistenandserve>#</a></h3><h4 id=使用默认的handler>使用默认的Handler<a hidden class=anchor aria-hidden=true href=#使用默认的handler>#</a></h4><p>先看一个简单的例子</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Hello, world!&#34;</span>))
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/blog&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;This is my Blog&#34;</span>))
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在启动一个HttpServer的时候, 其实我们就关心2个东西:</p><ul><li>地址</li><li>路由: 将请求对应到相应的处理函数中去</li></ul><p>这两个参数 在<code>http.ListenAndServe(":12345", nil)</code>中进行设置的, 第一个为地址, 第二个传递处理函数.</p><p>如果传递<code>nil</code>, 则采用默认的</p><blockquote><p>The handler is typically nil, in which case the DefaultServeMux is used.</p></blockquote><p><code>http.ListenAndServe</code>的实现如下:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#a6e22e>addr</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>handler</span> <span style=color:#a6e22e>Handler</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>server</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Server</span>{<span style=color:#a6e22e>Addr</span>: <span style=color:#a6e22e>addr</span>, <span style=color:#a6e22e>Handler</span>: <span style=color:#a6e22e>handler</span>}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>server</span>.<span style=color:#a6e22e>ListenAndServe</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Handler</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>Request</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>可以看到 <code>Handler</code>是一个接口, 实现这个接口的话, 我们可以创建自己的Handler</p><h4 id=自定义handler>自定义Handler<a hidden class=anchor aria-hidden=true href=#自定义handler>#</a></h4><p>定义一个结构体, 结构体实现 <code>ServeHTTP(w http.ResponseWriter, r *http.Request)</code>方法</p><p>然后使用 <code>Handle</code>函数进行路由注册</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyIndexHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MyIndexHandler</span>) <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Hello World&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>MyBlogHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>h</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>MyBlogHandler</span>) <span style=color:#a6e22e>ServeHTTP</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;This is my Blog&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewServeMux</span>()
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MyIndexHandler</span>{})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>Handle</span>(<span style=color:#e6db74>&#34;/blog&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>MyBlogHandler</span>{})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#a6e22e>mux</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>OSX MP16 ~ ❯ curl localhost:12345                                                          
</span></span><span style=display:flex><span>Hello World
</span></span><span style=display:flex><span>OSX MP16 ~ ❯ curl localhost:12345/blog                                                     
</span></span><span style=display:flex><span>This is my Blog
</span></span><span style=display:flex><span>OSX MP16 ~ ❯
</span></span></code></pre></div><p>但这明显看出来, 对每一个路由 都要高写一个xxxHandler结构体和实现ServeHTTP, 看上去非常混乱</p><p>这时候就可以用<code>mux.HandleFunc</code>来实现路由</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>mux</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewServeMux</span>()
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;Hello World&#34;</span>))
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>mux</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/blog&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#e6db74>&#34;This is my Blog&#34;</span>))
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:12345&#34;</span>, <span style=color:#a6e22e>mux</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=自定义servemux>自定义ServeMux<a hidden class=anchor aria-hidden=true href=#自定义servemux>#</a></h4><p>在上面的例子中, <code>mux := http.NewServeMux()</code>还是使用了默认router, 其简单的同时也有不少缺点</p><p>比如, 其是通过url进行路由, 但不支持基于方法(GET, POST&mldr;)的路由, 不支持正则表达式等等</p><p>参考这个 <a href=https://www.alexedwards.net/blog/which-go-router-should-i-use>https://www.alexedwards.net/blog/which-go-router-should-i-use</a></p><h2 id=人气web框架>人气Web框架<a hidden class=anchor aria-hidden=true href=#人气web框架>#</a></h2><p>参考这篇文章,</p><p><a href=https://blog.51cto.com/coderaction/3001008>https://blog.51cto.com/coderaction/3001008</a></p><p>其中有各框架的对比, 功能上iris最全</p><p><a href=https://github.com/kataras/iris>https://github.com/kataras/iris</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=../../tags/#go%23/>#go#</a></li><li><a href=../../tags/#golang%23/>#golang#</a></li></ul><nav class=paginav><a class=prev href=../../posts/golang_goroutings_under_the_hood/><span class=title>« Prev Page</span><br><span>[Golang]goroutings本质</span></a>
<a class=next href=../../posts/go_talk_about_sync/><span class=title>Next Page »</span><br><span>[Golang]聊聊sync</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href>Zhouyinhui's Space</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>