[
  
  {
    "title": "goè¯­è¨€ä¸­Channelæ˜¯å¦‚ä½•å·¥ä½œçš„",
    "url": "/posts/go%E8%AF%AD%E8%A8%80%E4%B8%ADchannel%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84/",
    "categories": "BlockChain, golang",
    "tags": "chan",
    "date": "2022-06-13 00:00:00 +0800",
    





    "snippet": "äº†è§£Golangé€šé“çš„å†…éƒ¨å·¥ä½œåŸç†goroutine(åç¨‹)å’Œé€šé“goroutineæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ç”¨æˆ·ç©ºé—´çº¿ç¨‹ï¼Œç”±Goè¿è¡Œæ—¶ç®¡ç†ã€‚å®ƒåŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼Œå¯èƒ½æ˜¯å¹¶è¡Œçš„ã€‚é€šé“æ˜¯ç”¨äºgoroutineä¹‹é—´çš„é€šä¿¡ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥äº†è§£é€šé“çš„å†…éƒ¨è¿ä½œå’Œå®ƒçš„å‘é€/æ¥æ”¶æ“ä½œã€‚ç¼“å†²é€šé“æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªç¼“å†²é€šé“ç”¨äºä¸‹é¢çš„è§£é‡Šã€‚ch := make(chan int, 3)      ä¸Šé¢çš„è¯­å¥åˆ›å»ºäº†ä¸€ä¸ªç¼“å†²é€šé“ï¼Œæœ€å¤šå¯ä»¥å®¹çº³ 3 ä¸ª int ç±»å‹çš„å€¼ã€‚åœ¨åº•å±‚ï¼Œmakeå‡½æ•° åœ¨å †ä¸Šåˆ†é…äº†ä¸€ä¸ª hchan ç»“æ„å¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘å®ƒçš„æŒ‡é’ˆã€‚ä»¥ä¸‹æ˜¯ hchan ç»“æ„çš„ä¸€äº›å­—æ®µåŠå…¶è§£é‡Šã€‚![img](./( ../../assets/img/1*wprFXP6zyl8FPC1PhvslsQ.png)some fields of hchan structtype hchan struct { buf      unsafe.Pointer sendx    uint recvx    uint lock     mutex  ...   // other fields}  buf æ˜¯ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œå®ƒç»´æŠ¤ç€ä¸€ä¸ªå¾ªç¯é˜Ÿåˆ—ã€‚  sendx æ˜¯æ•°ç»„ä¸­å‘é€å…ƒç´ çš„ç´¢å¼•  recvx æ˜¯æ”¶åˆ°çš„å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•  lock ç¡®ä¿é€šé“çš„è¯»å†™æ˜¯ä¸€ä¸ªåŸå­æ€§çš„æ“ä½œéé˜»å¡çš„å‘é€å’Œæ¥æ”¶å½“é€šé“æœªæ»¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¾ªç¯é˜Ÿåˆ—çš„åé¢æ’å…¥å…ƒç´ ï¼Œè€Œä¸ä¼šæœ‰é˜»å¡ã€‚// G1 sends three elements into the channel, capicity = 3ch &lt;- elem1ch &lt;- elem2ch &lt;- elem3â€‹å½“é€šé“ä¸æ˜¯ç©ºçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä»å¾ªç¯é˜Ÿåˆ—çš„å‰é¢æ¥æ”¶å…ƒç´ ï¼Œè€Œä¸ä¼šæœ‰é˜»å¡ã€‚// G2 receive three elements from the channel, capicity = 3&lt;- ch&lt;- ch&lt;- châ€‹é˜»å¡åœ¨å¤„ç†goroutineä¹‹é—´çš„é˜»å¡æ—¶ï¼Œå…¶ä»–å­—æ®µä¹Ÿå¾ˆé‡è¦ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ã€‚some fields of hchan struct  recvq (é“¾è¡¨)å­˜å‚¨è¯•å›¾åœ¨é€šé“ä¸Šè¯»å–æ•°æ®æ—¶è¢«é˜»å¡çš„goroutinesã€‚  sendq(é“¾è¡¨) å­˜å‚¨è¯•å›¾ä»é€šé“å‘é€æ•°æ®æ—¶è¢«é˜»å¡çš„goroutinesã€‚  Remember that Both of recq and sendq are linked list.type hchan struct { buf      unsafe.Pointer sendx    uint recvx    uint lock     mutex  sendq    waitq    recvq    waitq  ...   // more fields}type waitq struct {  first *sudog        last  *sudog}// pseudo goroutinetype sudog struct {  g     *g  elem  unsafe.Pointer   next  *sudog        prev  *sudog  ...  c     *hchan}ä»ç©ºä¿¡é“è¿›è¡Œæ¥æ”¶å½“é€šé“ä¸ºç©ºæ—¶ï¼Œä¸€ä¸ªæ¥æ”¶æ“ä½œä¼šå¯¼è‡´å½“å‰çš„åç¨‹è¢«é˜»å¡ã€‚æ‰€æœ‰è¢«é˜»å¡çš„åç¨‹éƒ½å­˜å‚¨åœ¨recvqé˜Ÿåˆ—ä¸­ã€‚  é˜»å¡çš„æ˜¯goroutinesï¼Œä½†ä¸æ˜¯OSçº¿ç¨‹ã€‚é‚£ä¹ˆï¼Œè¢«é˜»å¡çš„goroutineä½•æ—¶ä¼šè¢«æ¢å¤å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å½“ä¸€ä¸ªæ–°çš„goroutineåœ¨é€šé“ä¸Šæ‰§è¡Œå‘é€æ“ä½œæ—¶ã€‚ä¸‹é¢æ˜¯è¯¦ç»†æƒ…å†µã€‚  ä¸€ä¸ªæ–°çš„goroutineå°†æ–°æ•°æ®ç›´æ¥å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªç­‰å¾…çš„goroutineçš„å…ƒç´ ä¸­  ç¬¬ä¸€ä¸ªç­‰å¾…çš„goroutineä»recvqä¸­å¼¹å‡ºã€‚  è¿è¡Œæ—¶è°ƒåº¦å™¨è®¾ç½®è¢«å¼¹å‡ºçš„goroutineä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œå¹¶å°†å…¶æ”¾åœ¨ â€œè¿è¡Œé˜Ÿåˆ— â€œä¸­ã€‚ç„¶åï¼Œè¢«é˜»å¡çš„ç¨‹åºè¢«è§¦å‘å¹¶å‡†å¤‡å†æ¬¡è¿è¡Œã€‚åœ¨â€æ»¡â€é€šé“ä¸Šè¿›è¡Œå‘é€å½“é€šé“æ»¡äº†ï¼Œæ¥ä¸‹æ¥çš„å‘é€æ“ä½œä¼šé˜»å¡å„è‡ªçš„goroutineã€‚æ‰€æœ‰è¢«é˜»å¡çš„goroutineséƒ½å­˜å‚¨åœ¨sendqé˜Ÿåˆ—ä¸­ã€‚(æ²¡æœ‰ç¼“å†²åŒºæˆ–è€…è¯´ç¼“å†²åŒºå¤§å°ä¸º0çš„é€šé“, å’Œç¼“å†²åŒºæ»¡äº†çš„é€šé“æƒ…å†µä¸€æ ·)ç›´åˆ°å¦ä¸€ä¸ªgoroutineçš„æ¥æ”¶ï¼Œè¢«é˜»å¡çš„goroutineè¢«æ¢å¤ã€‚ä¸‹é¢æ˜¯è¯¦ç»†æƒ…å†µã€‚  å½“ä¸€ä¸ªæ–°çš„goroutineåœ¨é€šé“ä¸Šæ‰§è¡Œæ¥æ”¶æ“ä½œæ—¶ï¼Œç¼“å†²åŒºçš„ç¬¬ä¸€ä¸ªå…ƒç´ è¢«ç§»é™¤  ç¬¬ä¸€ä¸ªç­‰å¾…çš„goroutineä»sendqå¼¹å‡ºã€‚  å¼¹å‡ºçš„goroutineçš„å…ƒç´ è¢«å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­  è¿è¡Œæ—¶è°ƒåº¦å™¨è®¾ç½®è¢«å¼¹å‡ºçš„goroutineä¸ºå¯è¿è¡ŒçŠ¶æ€ï¼Œå¹¶å°†å…¶æ”¾åœ¨ â€œè¿è¡Œé˜Ÿåˆ— â€œä¸­ã€‚ç„¶åï¼Œè¢«é˜»å¡çš„ç¨‹åºè¢«è§¦å‘å¹¶å‡†å¤‡å†æ¬¡è¿è¡Œã€‚é€šé“æ˜¯goä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§å’Œæœ‰è¶£çš„æœºåˆ¶ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿè§£é‡Šå›´æ£‹ä¸­é€šé“çš„åŸºæœ¬å·¥ä½œåŸç†ã€‚å‚è€ƒæ–‡ç«   Diving Deep Into The Golang Channels  Concurrency And Parallelism in Golang  Go a Tale of Concurrency a Beginners Guideå¦å¤–, è¿™ç¯‡æ–‡ç« ä¹Ÿä¸é”™  https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel/"
  },
  
  {
    "title": "golang http server",
    "url": "/posts/golang_http_server/",
    "categories": "BlockChain, golang",
    "tags": "http",
    "date": "2022-06-13 00:00:00 +0800",
    





    "snippet": "golang ä¸­http server åŸºç¡€çŸ¥è¯†.ç®€å•çš„æ–‡ä»¶æœåŠ¡å™¨package mainimport (\t\"log\"\t\"net/http\")func main() {\terr := http.ListenAndServe(\":8080\", http.FileServer(http.Dir(\".\")))\tif err != nil {\t\tlog.Fatal(err)\t}}ä¸Šé¢è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªä»¥å½“å‰ç›®å½•ä¸ºç«™ç‚¹è·Ÿç›®å½•çš„æ–‡ä»¶æœåŠ¡å™¨,  æˆ‘ä¸€èˆ¬ç”¨è¿™ä¸ªæ¥ä½œä¸ºå±€åŸŸç½‘æ–‡ä»¶å…±äº«.ç„¶åå†™ä¸€ä¸ªå‡½æ•°æ”¾åˆ°bash.rc æˆ–zshrcä¸­#æ–‡ä»¶æœåŠ¡å™¨function fileserver(){\techo \"start file server :12345\"\tcat &lt;&lt;EOF | tee /tmp/fileserver.go | go run /tmp/fileserver.gopackage mainimport (\t\"log\"\t\"net/http\")func main() {\terr := http.ListenAndServe(\":12345\", http.FileServer(http.Dir(\".\")))\tif err != nil {\t\tlog.Fatal(err)\t}}EOF}OSX MP16 ~/Downloads â¯ fileserver                                                         start file server :12345Pythonä¸­æœ‰ç›¸åŒçš„åŠŸèƒ½python3 -m SimpleHTTPServer 7777  æˆ– python3 -m http.serverä¸€ä¸ªç®€å•çš„WebServerpackage mainimport (\t\"log\"\t\"net/http\")func main() {\thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\t\t_, err := w.Write([]byte(\"Hello World!\\n\"))\t\tif err != nil {\t\t\tlog.Println(err)\t\t}\t})\terr := http.ListenAndServe(\":12345\", nil)\tif err != nil {\t\tlog.Fatal(err)\t}}è®¿é—®ä¸€ä¸‹è¯•è¯•:OSX MP16 ~/Downloads/goplayground â¯ curl http://localhost:12345          Hello World!http.HandleFunchttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\t\t//...\t})è¯¥æ–¹æ³•æä¾›äº†ä¸€ç§æŒ‡å®šå¦‚ä½•å¤„ç†ç‰¹å®šè·¯ç”±çš„è¯·æ±‚çš„æ–¹æ³•, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè·¯ç”±, ç¬¬äºŒä¸ªå‚æ•°ä¸ºå¤„ç†å‡½æ•°. å¤„ç†å‡½æ•°å¯å†™æˆåŒ¿åå‡½æ•°, ä¹Ÿå¯ä»¥å£°æ˜ä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°func rootHandler(w http.ResponseWriter, r *http.Request) {\t_, err := w.Write([]byte(\"&lt;h1 style=\\\"color:Tomato;\\\"&gt;Hello World&lt;/h1&gt;\"))\tif err != nil {\t\tlog.Println(err)\t}}func main() {\thttp.HandleFunc(\"/\", rootHandler)  //...}å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯http.ResponseWriterç±»å‹çš„å€¼ã€‚è¿™æ˜¯ç”¨äºå‘ä»»ä½•è¿æ¥çš„HTTPå®¢æˆ·ç«¯å‘é€å“åº”çš„æœºåˆ¶ã€‚è¿™ä¹Ÿæ˜¯å“åº”æ ‡å¤´çš„è®¾ç½®æ–¹å¼,æ¯”å¦‚w.WriteHeader(http.StatusOK)ã€‚ç¬¬äºŒä¸ªè®ºç‚¹æ˜¯æŒ‡å‘http.Requestçš„æŒ‡é’ˆã€‚è¿™æ˜¯ä»ç½‘ç»œè¯·æ±‚ä¸­æ£€ç´¢æ•°æ®çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è¯·æ±‚æŒ‡é’ˆè®¿é—®è¡¨å•æäº¤çš„è¯¦ç»†ä¿¡æ¯æ¯”å¦‚ ä¸‹é¢çš„æ–¹æ³•, ä½¿ç”¨ http://127.0.0.1:12345/?key=date æ—¶å°†è¿”å›å½“å‰çš„æ—¥æœŸ, ç¡®å®key=æˆ–keyä¸æ­£ç¡®æ—¶è¿”å›http.StatusBadRequestfunc rootHandler(w http.ResponseWriter, r *http.Request) {\tkeys, ok := r.URL.Query()[\"key\"]\tif !ok || len(keys[0]) &lt; 1 {\t\tlog.Println(\"Url Param 'key' is missing\")\t\tw.WriteHeader(http.StatusBadRequest)\t\t_, err := w.Write([]byte(\"Url Param 'key' is missing\"))\t\tif err != nil {\t\t\tlog.Println(err)\t\t\treturn\t\t}\t\treturn\t}\tkey := keys[0]\tswitch key {\tcase \"date\":\t\tw.WriteHeader(http.StatusOK)\t\t_, err := w.Write([]byte(time.Now().Format(\"2006-01-02\")))\t\tif err != nil {\t\t\tlog.Println(err)\t\t}\tdefault:\t\tw.WriteHeader(http.StatusBadRequest)\t\t_, _ = w.Write([]byte(\"Invalid key\"))\t\tlog.Println(\"Invalid key\")\t}}http.ResponseWriterç”¨äºå‘ä»»ä½•è¿æ¥çš„HTTPå®¢æˆ·ç«¯å‘é€å“åº”è®¾ç½®ç›¸åº”æ ‡å¿—å¤´:   w.WriteHeader(http.StatusOK)è·å–æˆ–å®åˆ™å“åº”å¤´   w.Header().Set(\"content-type\", \"application/json\")   w.Header().Add(\"foo\", \"bar\")å†™å…¥ç›¸åº”æ•°æ®:   w.Write([]byte(time.Now().Format(\"2006-01-02\")))ä¾‹å­:package mainimport (\t\"encoding/json\"\t\"log\"\t\"net/http\")type SystemInfo struct {\tHostname string `json:\"hostname\"`\tUptime   string `json:\"uptime\"`}func rootHandler(w http.ResponseWriter, r *http.Request) {\tinfo := SystemInfo{\t\tHostname: \"test\",\t\tUptime:   \"2022-01-01 00:00:00\",\t}\tw.Header().Set(\"Content-Type\", \"application/json\")\tw.WriteHeader(http.StatusOK)\tbytes, _ := json.Marshal(info)\t_, err := w.Write(bytes)\tif err != nil {\t\tlog.Println(\"Error writing response: \", err)\t}}func main() {\thttp.HandleFunc(\"/\", rootHandler)\terr := http.ListenAndServe(\":12345\", nil)\tif err != nil {\t\tlog.Fatal(err)\t}}OSX MP16 ~ â¯ curl localhost:12345                                                         {\"hostname\":\"test\",\"uptime\":\"2022-01-01 00:00:00\"}*http.RequestæŒ‡å‘http.Requestçš„æŒ‡é’ˆ, é€šè¿‡æ”¹æŒ‡é’ˆå¯ä»¥è·å–è¯·æ±‚ä¸­çš„å„ç§æ•°æ®, æ¯”å¦‚è·å–åŸºæœ¬ä¿¡æ¯func rootHandler(w http.ResponseWriter, r *http.Request) {\tfmt.Println(\"User Agent: \", r.UserAgent())\tfmt.Println(\"Host: \", r.Host)\tfmt.Println(\"Remote Address: \", r.RemoteAddr)\tfmt.Println(\"Request URI: \", r.RequestURI)\tfmt.Println(\"Method: \", r.Method)\tfmt.Println(\"URL: \", r.URL)\tfmt.Println(\"Header: \", r.Header)\tw.WriteHeader(http.StatusOK)}è¾“å‡º:User Agent:  curl/7.79.1Host:  localhost:12345Remote Address:  127.0.0.1:58967Request URI:  /Method:  GETURL:  /Header:  map[Accept:[*/*] User-Agent:[curl/7.79.1]]è·å–cookiefunc rootHandler(w http.ResponseWriter, r *http.Request) {\t//è·å–æ‰€æœ‰\tfor _, c := range r.Cookies() {\t\tfmt.Printf(\"%s : %q\\n\", c.Name, c.Value)\t}\t//è·å–æŒ‡å®š\tc, err := r.Cookie(\"token\")\tif err != nil {\t\tlog.Println(err)\t}\tfmt.Printf(\"%s : %q\\n\", c.Name, c.Value)\tw.WriteHeader(http.StatusOK)}curl --cookie \"token=abcdefg\" http://localhost:12345è·å–GETå‚æ•°      è·å–æ‰€æœ‰å‚æ•° args := r.URL.Query()        è·å–æŒ‡å®šå‚æ•°(æ³¨:å‚æ•°å¯èƒ½è¢«é‡å¤å†™å¤šæ¬¡)    æ¯”å¦‚: localhost:12345/?id=5    func rootHandler(w http.ResponseWriter, r *http.Request) {\tids, ok := r.URL.Query()[\"id\"]\tif !ok || len(ids[0]) &lt; 1 {\t\tlog.Println(\"Url Param 'id' is missing\")\t\treturn\t}\tid := ids[0]\tlog.Println(\"Url Param 'id' is: \" + id)  \t\tw.WriteHeader(http.StatusOK)}      æˆ–è€…func rootHandler(w http.ResponseWriter, r *http.Request) {\tid := r.FormValue(\"id\")\tif id == \"\" {\t\tlog.Println(\"Url Param 'id' is missing\")\t}\tfmt.Println(\"id:\", id)\tw.WriteHeader(http.StatusOK)}  ä¹Ÿå¯ä»¥é€šè¿‡r.Formæ¥è·å–Getå‚æ•°è·å–PATCH, POST or PUTå‚æ•°æ¯”å¦‚ curl -d \"id=5&amp;format=1\" http://localhost:12345/func rootHandler(w http.ResponseWriter, r *http.Request) {\t//parse\terr := r.ParseForm()\tif err != nil {\t\tlog.Println(\"ParseForm error:\", err)\t}\t//get post args\tfor k, v := range r.PostForm {\t\tlog.Println(\"key:\", k)\t\tlog.Println(\"val:\", v) // v []string\t}\tw.WriteHeader(http.StatusOK)}è¾“å‡º2022/06/06 15:14:46 key: id2022/06/06 15:14:46 val: [5]2022/06/06 15:14:46 key: format2022/06/06 15:14:46 val: [1]ParseFormä¼šå¡«å……r.Formå’Œr.PostFormã€‚å¯¹äºæ‰€æœ‰çš„è¯·æ±‚ï¼ŒParseFormè§£ææ¥è‡ªURLçš„åŸå§‹æŸ¥è¯¢å¹¶æ›´æ–°r.Formã€‚å¯¹äºPOSTã€PUTå’ŒPATCHè¯·æ±‚ï¼Œå®ƒä¹Ÿè¯»å–è¯·æ±‚æ­£æ–‡ï¼Œå°†å…¶è§£æä¸ºä¸€ä¸ªè¡¨å•ï¼Œå¹¶å°†ç»“æœæ”¾å…¥r.PostFormå’Œr.Formä¸­ã€‚åœ¨r.Formä¸­ï¼Œè¯·æ±‚æ­£æ–‡å‚æ•°ä¼˜å…ˆäºURLæŸ¥è¯¢å­—ç¬¦ä¸²å€¼ã€‚å¦‚æœè¯·æ±‚ä½“çš„å¤§å°è¿˜æ²¡æœ‰è¢«MaxBytesReaderé™åˆ¶ï¼Œé‚£ä¹ˆå…¶å¤§å°å°†è¢«é™åˆ¶åœ¨10MBã€‚å¯¹äºå…¶ä»–HTTPæ–¹æ³•ï¼Œæˆ–è€…å½“å†…å®¹ç±»å‹ä¸æ˜¯application/x-www-form-urlencodedæ—¶ï¼Œè¯·æ±‚æ­£æ–‡ä¸è¢«è¯»å–ï¼Œå¹¶ä¸”r.PostFormè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªéé›¶çš„ç©ºå€¼ã€‚ParseMultipartFormè‡ªåŠ¨è°ƒç”¨ParseFormã€‚ParseFormæ˜¯å¹‚ç­‰çš„ã€‚  r.Formå±æ€§åŒ…å«äº†postè¡¨å•å’Œurlä¸­çš„getå‚æ•°ã€‚  r.PostFormå±æ€§åªåŒ…å«äº†postè¡¨å•å‚æ•°ã€‚è·å–æŒ‡å®šå‚æ•°, æ¯”å¦‚func rootHandler(w http.ResponseWriter, r *http.Request) {\terr := r.ParseForm()\tif err != nil {\t\tlog.Println(\"ParseForm error:\", err)\t}\tids := r.PostForm.Get(\"id\") //è·å–idå‚æ•°çš„ç¬¬ä¸€ä¸ªå€¼\tlog.Println(\"id:\", ids)\tw.WriteHeader(http.StatusOK)}æˆ–è€…func rootHandler(w http.ResponseWriter, r *http.Request) {\tid := r.PostFormValue(\"id\")\tif id == \"\" {\t\tlog.Println(\"Url Param 'id' is missing\")\t}\tfmt.Println(\"id:\", id)\tw.WriteHeader(http.StatusOK)}è·å–ä¸Šä¼ æ–‡ä»¶æ¯”å¦‚ curl -F \"file=@IMG_1526.PNG;type=image/png\" http://localhost:12345/uploadä¸‹é¢ä»£ç ä¸­:r.ParseMultipartForm(10 &lt;&lt; 20)å°†ä¸€ä¸ªè¯·æ±‚ä½“è§£æä¸ºmultipart/form-dataã€‚æ•´ä¸ªè¯·æ±‚æ­£æ–‡è¢«è§£æï¼Œå¹¶ä¸”å…¶æ–‡ä»¶éƒ¨åˆ†æœ€å¤šå­˜å‚¨åœ¨maxMemoryå­—èŠ‚çš„å†…å­˜ä¸­ï¼Œå…¶ä½™éƒ¨åˆ†åˆ™å­˜å‚¨åœ¨ç£ç›˜çš„ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚ParseMultipartFormåœ¨å¿…è¦æ—¶è°ƒç”¨ParseFormã€‚å¦‚æœParseFormè¿”å›ä¸€ä¸ªé”™è¯¯ï¼ŒParseMultipartFormå°†å…¶è¿”å›ï¼Œä½†ä¹Ÿç»§ç»­è§£æè¯·æ±‚æ­£æ–‡ã€‚åœ¨å¯¹ParseMultipartFormè¿›è¡Œä¸€æ¬¡è°ƒç”¨åï¼Œéšåçš„è°ƒç”¨æ²¡æœ‰ä»»ä½•å½±å“.FormFile è¿”å›æä¾›çš„è¡¨å•keyçš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœéœ€è¦ï¼ŒFormFileä¼šè°ƒç”¨ParseMultipartFormå’ŒParseFormã€‚package mainimport (\t\"io\"\t\"log\"\t\"mime/multipart\"\t\"net/http\"\t\"os\")func uploadHandler(w http.ResponseWriter, r *http.Request) {\t// Parse the multipart form in the request\terr := r.ParseMultipartForm(10 &lt;&lt; 20) // 10 MiB\tif err != nil {\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\t\treturn\t}\t\t\t// FormFile returns the first file for the given key `file`\t// it also returns the FileHeader, so we can get the Filename, the Header and the size of the file\tfile, handler, err := r.FormFile(\"file\")\tif err != nil {\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\t\treturn\t}\tdefer func(file multipart.File) {\t\terr := file.Close()\t\tif err != nil {\t\t\tlog.Println(err)\t\t}\t}(file)\terr = os.MkdirAll(\"./upload\", 0777)\tif err != nil {\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\t\treturn\t}\tlocalFile, err := os.OpenFile(\"./upload/\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\tif err != nil {\t\thttp.Error(w, err.Error(), http.StatusInternalServerError)\t\treturn\t}\tdefer func(localFile *os.File) {\t\terr := localFile.Close()\t\tif err != nil {\t\t\tlog.Println(err)\t\t}\t}(localFile)\t_, err = io.Copy(localFile, file)\tif err != nil {\t\thttp.Error(w, \"\", http.StatusInternalServerError)    return\t}\tw.WriteHeader(http.StatusOK)}func main() {\thttp.HandleFunc(\"/upload\", uploadHandler)\terr := http.ListenAndServe(\":12345\", nil)\tif err != nil {\t\tlog.Fatal(err)\t}}ğŸ‘å„ç§è·å–å‚æ•°æ–¹å¼æ¯”è¾ƒ            æ“ä½œ      è§£æ      è¯»å–URLå‚æ•°      è¯»å–Bodyè¡¨å•      æ”¯æŒæ–‡æœ¬      æ”¯æŒäºŒè¿›åˆ¶                  r.Form      r.ParseForm()      Y      Y      Y      Â               r.PostForm      r.ParseForm()      Â       Y      Y      Â               r.FormValue()      è‡ªåŠ¨è°ƒç”¨r.ParseForm()      Y      Y      Y      Â               r.PostFormValue()      è‡ªåŠ¨è°ƒç”¨r.ParseForm()      Â       Y      Y      Â               r.MultipartForm      ParseMultipartForm()      Â       Y      Y      Y              r.FormFile      è‡ªåŠ¨è°ƒç”¨ParseMultipartForm()      Â       Y      Â       Y      Handler , Handle , HandleFunc ä¸ http.ListenAndServeä½¿ç”¨é»˜è®¤çš„Handlerå…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­package mainimport \"net/http\"func main() {\thttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\t\tw.Write([]byte(\"Hello, world!\"))\t})\thttp.HandleFunc(\"/blog\", func(w http.ResponseWriter, r *http.Request) {\t\tw.Write([]byte(\"This is my Blog\"))\t})\thttp.ListenAndServe(\":12345\", nil)}åœ¨å¯åŠ¨ä¸€ä¸ªHttpServerçš„æ—¶å€™, å…¶å®æˆ‘ä»¬å°±å…³å¿ƒ2ä¸ªä¸œè¥¿:  åœ°å€  è·¯ç”±: å°†è¯·æ±‚å¯¹åº”åˆ°ç›¸åº”çš„å¤„ç†å‡½æ•°ä¸­å»è¿™ä¸¤ä¸ªå‚æ•° åœ¨http.ListenAndServe(\":12345\", nil)ä¸­è¿›è¡Œè®¾ç½®çš„, ç¬¬ä¸€ä¸ªä¸ºåœ°å€, ç¬¬äºŒä¸ªä¼ é€’å¤„ç†å‡½æ•°.å¦‚æœä¼ é€’nil, åˆ™é‡‡ç”¨é»˜è®¤çš„  The handler is typically nil, in which case the DefaultServeMux is used.http.ListenAndServeçš„å®ç°å¦‚ä¸‹:func ListenAndServe(addr string, handler Handler) error {\tserver := &amp;Server{Addr: addr, Handler: handler}\treturn server.ListenAndServe()}type Handler interface {   ServeHTTP(ResponseWriter, *Request)}å¯ä»¥çœ‹åˆ° Handleræ˜¯ä¸€ä¸ªæ¥å£, å®ç°è¿™ä¸ªæ¥å£çš„è¯, æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„Handlerè‡ªå®šä¹‰Handlerå®šä¹‰ä¸€ä¸ªç»“æ„ä½“, ç»“æ„ä½“å®ç° ServeHTTP(w http.ResponseWriter, r *http.Request)æ–¹æ³•ç„¶åä½¿ç”¨ Handleå‡½æ•°è¿›è¡Œè·¯ç”±æ³¨å†Œpackage mainimport \"net/http\"type MyIndexHandler struct {}func (h *MyIndexHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\tw.Write([]byte(\"Hello World\"))}type MyBlogHandler struct {}func (h *MyBlogHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\tw.Write([]byte(\"This is my Blog\"))}func main() {\tmux := http.NewServeMux()\tmux.Handle(\"/\", &amp;MyIndexHandler{})\tmux.Handle(\"/blog\", &amp;MyBlogHandler{})\thttp.ListenAndServe(\":12345\", mux)}OSX MP16 ~ â¯ curl localhost:12345                                                          Hello WorldOSX MP16 ~ â¯ curl localhost:12345/blog                                                     This is my BlogOSX MP16 ~ â¯ä½†è¿™æ˜æ˜¾çœ‹å‡ºæ¥, å¯¹æ¯ä¸€ä¸ªè·¯ç”± éƒ½è¦é«˜å†™ä¸€ä¸ªxxxHandlerç»“æ„ä½“å’Œå®ç°ServeHTTP, çœ‹ä¸Šå»éå¸¸æ··ä¹±è¿™æ—¶å€™å°±å¯ä»¥ç”¨mux.HandleFuncæ¥å®ç°è·¯ç”±package mainimport \"net/http\"func main() {   mux := http.NewServeMux()   mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {      w.Write([]byte(\"Hello World\"))   })   mux.HandleFunc(\"/blog\", func(w http.ResponseWriter, r *http.Request) {      w.Write([]byte(\"This is my Blog\"))   })   http.ListenAndServe(\":12345\", mux)}è‡ªå®šä¹‰ServeMuxåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, mux := http.NewServeMux()è¿˜æ˜¯ä½¿ç”¨äº†é»˜è®¤router, å…¶ç®€å•çš„åŒæ—¶ä¹Ÿæœ‰ä¸å°‘ç¼ºç‚¹æ¯”å¦‚, å…¶æ˜¯é€šè¿‡urlè¿›è¡Œè·¯ç”±, ä½†ä¸æ”¯æŒåŸºäºæ–¹æ³•(GET, POSTâ€¦)çš„è·¯ç”±, ä¸æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ç­‰ç­‰å‚è€ƒè¿™ä¸ª https://www.alexedwards.net/blog/which-go-router-should-i-useäººæ°”Webæ¡†æ¶å‚è€ƒè¿™ç¯‡æ–‡ç« ,https://blog.51cto.com/coderaction/3001008å…¶ä¸­æœ‰å„æ¡†æ¶çš„å¯¹æ¯”, åŠŸèƒ½ä¸Širisæœ€å…¨https://github.com/kataras/iris"
  }
  
]

