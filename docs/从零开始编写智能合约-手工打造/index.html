<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>从零开始编写智能合约-手工打造 - YINHUI&#39;s BLOG</title><meta name="Description" content="银辉的博客"><meta property="og:title" content="从零开始编写智能合约-手工打造" />
<meta property="og:description" content="前面在 从零开始编写智能合约-使用traffle套件 中 使用 truffle套件从零开始搭建环境, 编写、部署、测试和调用智能合约, 这次我们只使用一些命令行工具来进行&quot;手工打造&quot;
配套代码: https://github.com/yinhui1984/stepByStepSmartContract" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" /><meta property="og:image" content="https://yinhui1984.github.io/avatar.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-01T00:00:00+00:00" /><meta property="og:site_name" content="YINHUI&#39;s BLOG" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://yinhui1984.github.io/avatar.png"/>

<meta name="twitter:title" content="从零开始编写智能合约-手工打造"/>
<meta name="twitter:description" content="前面在 从零开始编写智能合约-使用traffle套件 中 使用 truffle套件从零开始搭建环境, 编写、部署、测试和调用智能合约, 这次我们只使用一些命令行工具来进行&quot;手工打造&quot;
配套代码: https://github.com/yinhui1984/stepByStepSmartContract"/>
<meta name="application-name" content="YINHUI&#39;s BLOG">
<meta name="apple-mobile-web-app-title" content="YINHUI&#39;s BLOG"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" /><link rel="prev" href="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E4%BD%BF%E7%94%A8truffle%E5%A5%97%E4%BB%B6/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "从零开始编写智能合约-手工打造",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yinhui1984.github.io\/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0\/"
        },"genre": "posts","keywords": "solidity, ethereum, go-ethereum, python","wordcount":  2662 ,
        "url": "https:\/\/yinhui1984.github.io\/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0\/","datePublished": "2022-07-01T00:00:00+00:00","dateModified": "2022-07-01T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "yinhui"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="YINHUI&#39;s BLOG"></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/"> 首页 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="YINHUI&#39;s BLOG"></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/" title="">首页</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">从零开始编写智能合约-手工打造</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/yinhui1984" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>yinhui</a></span>&nbsp;<span class="post-category">included in <a href="/categories/blockchain/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>BlockChain</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-07-01">2022-07-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;2662 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#创建测试链">创建测试链</a>
      <ul>
        <li><a href="#安装geth">安装geth</a></li>
        <li><a href="#创建一个账户">创建一个账户</a></li>
        <li><a href="#找一个网络id">找一个网络ID</a></li>
        <li><a href="#编写创世文件">编写&quot;创世文件&quot;</a></li>
        <li><a href="#初始化区块链">初始化区块链</a></li>
      </ul>
    </li>
    <li><a href="#运行区块链">运行区块链</a></li>
    <li><a href="#与测试链进行交互">与测试链进行交互</a></li>
    <li><a href="#一键生成测试链">一键生成测试链</a></li>
    <li><a href="#编写智能合约">编写智能合约</a></li>
    <li><a href="#编译智能合约">编译智能合约</a></li>
    <li><a href="#部署智能合约">部署智能合约</a></li>
    <li><a href="#调用智能合约">调用智能合约</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>前面在 <a href="https://yinhui1984.github.io/%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e7%bc%96%e5%86%99%e6%99%ba%e8%83%bd%e5%90%88%e7%ba%a6-%e4%bd%bf%e7%94%a8traffle%e5%a5%97%e4%bb%b6/" target="_blank" rel="noopener noreffer ">从零开始编写智能合约-使用traffle套件</a> 中 使用 <code>truffle</code>套件从零开始搭建环境, 编写、部署、测试和调用智能合约, 这次我们只使用一些命令行工具来进行&quot;手工打造&quot;</p>
<p>配套代码: <a href="https://github.com/yinhui1984/stepByStepSmartContract" target="_blank" rel="noopener noreffer ">https://github.com/yinhui1984/stepByStepSmartContract</a></p>
<h2 id="创建测试链">创建测试链</h2>
<p>还是以ETH为例, 使用 <code>Go Ethereum</code> <a href="https://geth.ethereum.org" target="_blank" rel="noopener noreffer ">https://geth.ethereum.org</a> 来创建 使用<code>POW</code>共识算法的一个简单私有链.</p>
<h3 id="安装geth">安装geth</h3>
<p>官方教程 <a href="https://geth.ethereum.org/docs/install-and-build/installing-geth" target="_blank" rel="noopener noreffer ">https://geth.ethereum.org/docs/install-and-build/installing-geth</a></p>
<p>或者自己下载安装包进行安装  <a href="https://geth.ethereum.org/downloads/" target="_blank" rel="noopener noreffer ">https://geth.ethereum.org/downloads/</a></p>
<p>安装完成后, 运行一下version表示成功</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">OSX MP16 ~/Downloads/privateNetwork ❯ geth version
</span></span><span class="line"><span class="cl">Geth
</span></span><span class="line"><span class="cl">Version: 1.10.16-stable
</span></span><span class="line"><span class="cl">Architecture: amd64
</span></span><span class="line"><span class="cl">Go Version: go1.17.6
</span></span><span class="line"><span class="cl">Operating System: darwin
</span></span><span class="line"><span class="cl"><span class="nv">GOPATH</span><span class="o">=</span>
</span></span><span class="line"><span class="cl"><span class="nv">GOROOT</span><span class="o">=</span>go
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="创建一个账户">创建一个账户</h3>
<p>下面的<code>创世文件</code>中的<code>coinbase</code>会用到这个账户, 用来接收挖矿的收入</p>
<p>为方便起见, 将账户密码写到password.txt , 当然这是不安全的行为.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="m">123456</span> &gt; password.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>新建账户:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">geth --datadir ./data/ account new --password ./password.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>其中的<code>datadir</code>是数据存储目录, 后面的数据文件都将存到这个目录中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">OSX MP16 ~/Downloads/privateNetwork ❯ geth --datadir ./data/ account new --password ./password.txt
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:10:34.007<span class="o">]</span> Maximum peer count                       <span class="nv">ETH</span><span class="o">=</span><span class="m">50</span> <span class="nv">LES</span><span class="o">=</span><span class="m">0</span> <span class="nv">total</span><span class="o">=</span><span class="m">50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Your new key was generated
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Public address of the key:   0x79dF0D3c23f22370881dC92aF524A1D5E52e3552
</span></span><span class="line"><span class="cl">Path of the secret key file: data/keystore/UTC--2022-07-01T02-10-34.008109000Z--79df0d3c23f22370881dc92af524a1d5e52e3552
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">- You can share your public address with anyone. Others need it to interact with you.
</span></span><span class="line"><span class="cl">- You must NEVER share the secret key with anyone! The key controls access to your funds!
</span></span><span class="line"><span class="cl">- You must BACKUP your key file! Without the key, it<span class="s1">&#39;s impossible to access account funds!
</span></span></span><span class="line"><span class="cl"><span class="s1">- You must REMEMBER your password! Without the password, it&#39;</span>s impossible to decrypt the key!
</span></span></code></pre></td></tr></table>
</div>
</div><p>打印内容中的 <code>0x79dF0D3c23f22370881dC92aF524A1D5E52e3552</code>是公钥, 也是我们的账户地址</p>
<h3 id="找一个网络id">找一个网络ID</h3>
<p><code>chainId</code>或者<code>network ID</code> 用于隔离以太坊对等网络。只有当两个对等点使用相同的创世块和网络 ID 时，区块链节点之间才会发生连接。使用 &ndash;networkid 命令行选项设置 geth 使用的网络 ID。</p>
<p>以太网主网 ID 为 1。如果您提供与主网不同的自定义网络 ID，您的节点将不会连接到其他节点并形成专用网络。如果您打算在 Internet 上连接到您的私有链，最好选择一个尚未使用的网络 ID。您可以在 <a href="https://chainid.network" target="_blank" rel="noopener noreffer ">https://chainid.network</a> 找到由社区运行的以太坊网络注册表。 这里我们只是在本地运行, 随便使用一个ID就可以了, 比如<code>1235</code></p>
<h3 id="编写创世文件">编写&quot;创世文件&quot;</h3>
<p>一个新的区块链在生成第一个区块, 也就是<code>创世块</code>的时候, 需要从<code>创世文件</code>来进行生成</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">touch genesis.json
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;nonce&#34;</span><span class="p">:</span> <span class="s2">&#34;0x0000000000000042&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;0x00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;parentHash&#34;</span><span class="p">:</span> <span class="s2">&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;extraData&#34;</span><span class="p">:</span> <span class="s2">&#34;0x00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;gasLimit&#34;</span><span class="p">:</span> <span class="s2">&#34;0x8000000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;difficulty&#34;</span><span class="p">:</span> <span class="s2">&#34;0x0400&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;byzantiumBlock&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;constantinopleBlock&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mixhash&#34;</span><span class="p">:</span> <span class="s2">&#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;coinbase&#34;</span><span class="p">:</span> <span class="s2">&#34;0x79dF0D3c23f22370881dC92aF524A1D5E52e3552&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;alloc&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;0x79dF0D3c23f22370881dC92aF524A1D5E52e3552&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;balance&#34;</span><span class="p">:</span> <span class="s2">&#34;1000000000000000000000&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;chainId&#34;</span><span class="p">:</span> <span class="mi">1235</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;homesteadBlock&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;eip150Block&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;eip155Block&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;eip158Block&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>关于创世文件中的各个字段的含义, 后面会有一篇专门的博客来讲</p>
<blockquote>
<p>注意: 将<code>coinbase</code> 以及 <code>alloc</code>中的地址修改为上面创建账户时你所得到的地址</p>
</blockquote>
<h3 id="初始化区块链">初始化区块链</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">geth --datadir ./data init ./genesis.json
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:50.915<span class="o">]</span> Maximum peer count                       <span class="nv">ETH</span><span class="o">=</span><span class="m">50</span> <span class="nv">LES</span><span class="o">=</span><span class="m">0</span> <span class="nv">total</span><span class="o">=</span><span class="m">50</span>
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:50.919<span class="o">]</span> Set global gas cap                       <span class="nv">cap</span><span class="o">=</span>50,000,000
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:50.919<span class="o">]</span> Allocated cache and file handles         <span class="nv">database</span><span class="o">=</span>/Users/zhouyinhui/Downloads/privateNetwork/data/geth/chaindata <span class="nv">cache</span><span class="o">=</span>16.00MiB <span class="nv">handles</span><span class="o">=</span><span class="m">16</span>
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.007<span class="o">]</span> Writing custom genesis block 
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.010<span class="o">]</span> Persisted trie from memory database      <span class="nv">nodes</span><span class="o">=</span><span class="m">0</span> <span class="nv">size</span><span class="o">=</span>0.00B <span class="nv">time</span><span class="o">=</span><span class="s2">&#34;21.005µs&#34;</span> <span class="nv">gcnodes</span><span class="o">=</span><span class="m">0</span> <span class="nv">gcsize</span><span class="o">=</span>0.00B <span class="nv">gctime</span><span class="o">=</span>0s <span class="nv">livenodes</span><span class="o">=</span><span class="m">1</span> <span class="nv">livesize</span><span class="o">=</span>0.00B
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.011<span class="o">]</span> Successfully wrote genesis state         <span class="nv">database</span><span class="o">=</span>chaindata <span class="nv">hash</span><span class="o">=</span>0ca0fb..b61b69
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.011<span class="o">]</span> Allocated cache and file handles         <span class="nv">database</span><span class="o">=</span>/Users/zhouyinhui/Downloads/privateNetwork/data/geth/lightchaindata <span class="nv">cache</span><span class="o">=</span>16.00MiB <span class="nv">handles</span><span class="o">=</span><span class="m">16</span>
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.090<span class="o">]</span> Writing custom genesis block 
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.090<span class="o">]</span> Persisted trie from memory database      <span class="nv">nodes</span><span class="o">=</span><span class="m">0</span> <span class="nv">size</span><span class="o">=</span>0.00B <span class="nv">time</span><span class="o">=</span><span class="s2">&#34;2.71µs&#34;</span>   <span class="nv">gcnodes</span><span class="o">=</span><span class="m">0</span> <span class="nv">gcsize</span><span class="o">=</span>0.00B <span class="nv">gctime</span><span class="o">=</span>0s <span class="nv">livenodes</span><span class="o">=</span><span class="m">1</span> <span class="nv">livesize</span><span class="o">=</span>0.00B
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>10:50:51.091<span class="o">]</span> Successfully wrote genesis state         <span class="nv">database</span><span class="o">=</span>lightchaindata <span class="nv">hash</span><span class="o">=</span>0ca0fb..b61b69
</span></span><span class="line"><span class="cl">OSX MP16 ~/Downloads/privateNetwork ❯ 
</span></span></code></pre></td></tr></table>
</div>
</div><p>生成的文件在 <code> ./data/geth</code>下</p>
<h2 id="运行区块链">运行区块链</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">geth --datadir ./data/ --networkid <span class="m">1235</span> --port <span class="m">8545</span>  --http --http.api <span class="s1">&#39;admin,eth,miner,net,txpool,personal,web3&#39;</span>  --mine --allow-insecure-unlock --unlock <span class="s1">&#39;0x79dF0D3c23f22370881dC92aF524A1D5E52e3552&#39;</span> --password password.txt
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code> --datadir</code> 数据文件目录</li>
<li><code>--networkid</code> 网络ID</li>
<li><code>--port</code> RPC端口</li>
<li><code>--http</code> 启用<code>http-rpc</code>服务</li>
<li><code>--http.api</code>提供那些API</li>
<li><code>--mine</code> 启用挖矿</li>
<li><code>--allow-insecure-unlock</code> 当账户相关的RPC被http暴露时，允许不安全的账户解锁</li>
<li><code>--unlock</code> 解锁账户 (多个账户用逗号分割)</li>
<li><code>--password</code> 解锁账户用到的密码文件</li>
</ul>
<p>成功运行后, 会看到很多打印信息, 其中值得注意的是下面这两行, 一个是ipc, 一个是http server, 我们会使用他们来和我们的区块链进行通讯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>11:08:58.245<span class="o">]</span> IPC endpoint opened                      <span class="nv">url</span><span class="o">=</span>/Users/zhouyinhui/Downloads/privateNetwork/data/geth.ipc
</span></span><span class="line"><span class="cl">INFO <span class="o">[</span>07-01<span class="p">|</span>11:08:58.245<span class="o">]</span> HTTP server started                      <span class="nv">endpoint</span><span class="o">=</span>127.0.0.1:8545 <span class="nv">prefix</span><span class="o">=</span> <span class="nv">cors</span><span class="o">=</span> <span class="nv">vhosts</span><span class="o">=</span>localhost
</span></span></code></pre></td></tr></table>
</div>
</div><p>另外一条是 我们作为区块链中的对等节点<code>PEER NODE</code>时的信息, 这里我们还用不到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> Started P2P networking                   <span class="nv">self</span><span class="o">=</span>enode://de2537c5f309be45bcb2d011cd172138db40295f74a288b07e03635e2194e7c2987cf97c9d295dc502053d9f7adda11052597c7f1bc5a5ec3d8182777138a0f1@127.0.0.1:8545
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>请保持区块链在后台运行, 后面的代码都需要用到</p>
</blockquote>
<h2 id="与测试链进行交互">与测试链进行交互</h2>
<p><code>attach</code>到测试链, 就可以启动一个js console, 和<code>truffle console</code>功能一样</p>
<p><strong>方式1, 通过IPC进行attach</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">geth attach /Users/zhouyinhui/Downloads/privateNetwork/data/geth.ipc
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">OSX MP16 ~/blockchain/private_net/tempchain ❯ geth attach /Users/zhouyinhui/Downloads/privateNetwork/data/geth.ipc
</span></span><span class="line"><span class="cl">Welcome to the Geth JavaScript console!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">To exit, press ctrl-d or <span class="nb">type</span> <span class="nb">exit</span>
</span></span><span class="line"><span class="cl">&gt; eth.chainId<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;0x4d3&#34;</span>
</span></span><span class="line"><span class="cl">&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>&quot;0x4d3&quot;</code> 也就是 我们的 <code>1235</code></p>
<p>其中 *.ipc 可以使用相对路径</p>
<p><strong>方式2, 通过http服务进行attach</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">geth attach http://127.0.0.1:8545
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="一键生成测试链">一键生成测试链</h2>
<p>上面那些繁琐的步骤可以搞成一个脚本, 一键生成, 这样来得更方便</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 一键创建ETH私有链，共识算法POW，如果要使用POA请修改createGenesisFile()中的配置文件</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 这只是练习使用，更好的做法是使用 ganache-cli</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ROOT_FOLDER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">DATA_FOLDER</span> <span class="o">=</span> <span class="s2">&#34;./data/&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ACCOUNT_FILE</span> <span class="o">=</span> <span class="s2">&#34;accounts.txt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">PASSWORD_FILE</span> <span class="o">=</span> <span class="s2">&#34;password.txt&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">GENESIS_FILE</span> <span class="o">=</span> <span class="s2">&#34;genesis.json&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">CHAIN_ID</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">:</span> <span class="n">List</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">sp</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">err</span> <span class="o">=</span> <span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">rtn</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">returncode</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print(&#34;[output]&#34;+out)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">out</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;return code:&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rtn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&#34; : &#34;</span> <span class="o">+</span> <span class="n">err</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">err</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ask_root_folder</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;the folder path of output:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">ROOT_FOLDER</span>
</span></span><span class="line"><span class="cl">    <span class="n">ROOT_FOLDER</span> <span class="o">=</span> <span class="n">p</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">ROOT_FOLDER</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">ROOT_FOLDER</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_account</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># geth account new --password &lt;(echo $mypassword)</span>
</span></span><span class="line"><span class="cl">    <span class="n">account</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;password of new account:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">PASSWORD_FILE</span><span class="p">,</span> <span class="s2">&#34;w+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">out</span> <span class="o">=</span> <span class="n">run_command</span><span class="p">([</span><span class="s2">&#34;geth&#34;</span><span class="p">,</span> <span class="s2">&#34;--datadir&#34;</span><span class="p">,</span> <span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="s2">&#34;account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                       <span class="s2">&#34;new&#34;</span><span class="p">,</span> <span class="s2">&#34;--password&#34;</span><span class="p">,</span> <span class="s2">&#34;./password.txt&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;0x.+&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">account</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ACCOUNT_FILE</span><span class="p">,</span> <span class="s2">&#34;w+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;account: &#34;</span> <span class="o">+</span> <span class="n">account</span> <span class="o">+</span> <span class="s2">&#34; with password:&#34;</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;creat account error!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">quit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">account</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_genesis</span><span class="p">(</span><span class="n">coinbase</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># use os.system(&#34;puppeth&#34;) is another option</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">CHAIN_ID</span>
</span></span><span class="line"><span class="cl">    <span class="n">CHAIN_ID</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;id of chain (numbers):&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">g</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">{{
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;nonce&#34;: &#34;0x0000000000000042&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;timestamp&#34;: &#34;0x00&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;parentHash&#34;: &#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;extraData&#34;: &#34;0x00&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;gasLimit&#34;: &#34;0x8000000&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;difficulty&#34;: &#34;0x0400&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;byzantiumBlock&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;constantinopleBlock&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;mixhash&#34;: &#34;0x0000000000000000000000000000000000000000000000000000000000000000&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;coinbase&#34;: &#34;</span><span class="si">{}</span><span class="s1">&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;alloc&#34;: {{
</span></span></span><span class="line"><span class="cl"><span class="s1">    }},
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#34;config&#34;: {{
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;chainId&#34;: </span><span class="si">{}</span><span class="s1">,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;homesteadBlock&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;eip150Block&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;eip155Block&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="s1">        &#34;eip158Block&#34;: 0
</span></span></span><span class="line"><span class="cl"><span class="s1">    }}
</span></span></span><span class="line"><span class="cl"><span class="s1">}}
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">coinbase</span><span class="p">,</span> <span class="n">CHAIN_ID</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">GENESIS_FILE</span><span class="p">,</span> <span class="s2">&#34;w+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">init_chain</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">run_command</span><span class="p">([</span><span class="s2">&#34;geth&#34;</span><span class="p">,</span> <span class="s2">&#34;--datadir&#34;</span><span class="p">,</span> <span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="s2">&#34;init&#34;</span><span class="p">,</span> <span class="n">GENESIS_FILE</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_run_script</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#  do not add   --http.corsdomain &#39;*&#39;  , it&#39;s not safe for private chain</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    geth --datadir </span><span class="si">{}</span><span class="s1"> --networkid </span><span class="si">{}</span><span class="s1"> --port 30310  --http --http.api &#39;admin,eth,miner,net,txpool,personal,web3&#39;  --mine --allow-insecure-unlock --unlock &#39;</span><span class="si">{}</span><span class="s1">&#39; --password password.txt
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">,</span> <span class="n">CHAIN_ID</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;run.sh&#34;</span><span class="p">,</span> <span class="s2">&#34;w+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">run_command</span><span class="p">([</span><span class="s2">&#34;chmod&#34;</span><span class="p">,</span> <span class="s2">&#34;+x&#34;</span><span class="p">,</span> <span class="s2">&#34;run.sh&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># runCommand([&#34;sh&#34;, &#34;run.sh&#34;])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_attach_script</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    geth attach </span><span class="si">{}</span><span class="s1">geth.ipc
</span></span></span><span class="line"><span class="cl"><span class="s1">    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">DATA_FOLDER</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;attach.sh&#34;</span><span class="p">,</span> <span class="s2">&#34;w+&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">run_command</span><span class="p">([</span><span class="s2">&#34;chmod&#34;</span><span class="p">,</span> <span class="s2">&#34;+x&#34;</span><span class="p">,</span> <span class="s2">&#34;attach.sh&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">ask_root_folder</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">account</span> <span class="o">=</span> <span class="n">create_account</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_genesis</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">init_chain</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_run_script</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">create_attach_script</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;DONE&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="编写智能合约">编写智能合约</h2>
<p>我们还是使用 <a href="https://yinhui1984.github.io/%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e7%bc%96%e5%86%99%e6%99%ba%e8%83%bd%e5%90%88%e7%ba%a6-%e4%bd%bf%e7%94%a8traffle%e5%a5%97%e4%bb%b6/" target="_blank" rel="noopener noreffer ">上篇博客中的</a>智能合约</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir ./contracts
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ./contracts
</span></span><span class="line"><span class="cl">touch Calculator.sol
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-solidity" data-lang="solidity"><span class="line"><span class="cl"><span class="c1">// SPDX-License-Identifier: MIT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pragma solidity</span> <span class="o">^</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">contract</span> <span class="nc">Calculator</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">function</span> <span class="nf">subtract</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="编译智能合约">编译智能合约</h2>
<p>如果你的电脑上没有<code>solc</code>, 请事先安装, 它是solidity的编译器, 官方教程: <a href="https://docs.soliditylang.org/en/v0.8.15/installing-solidity.html#installing-solidity" target="_blank" rel="noopener noreffer ">https://docs.soliditylang.org/en/v0.8.15/installing-solidity.html#installing-solidity</a></p>
<p>编译:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">solc --bin --abi -o ./build ./Calculator.sol
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>--bin</code> 生成16进制文件</li>
<li><code>--abi</code>生成abi文件</li>
<li><code>-o</code>输出目录</li>
</ul>
<p>可以写一个<code>Makefile</code>来干这个事情:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-makefile" data-lang="makefile"><span class="line"><span class="cl"><span class="nf">all</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	solc --bin --abi --overwrite -o ./build ./Calculator.sol
</span></span><span class="line"><span class="cl"><span class="nf">clean</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	rm -rf ./build/*
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">OSX MP16 ~/Downloads/privateNetwork/contracts ❯ tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── Calculator.sol
</span></span><span class="line"><span class="cl">├── Makefile
</span></span><span class="line"><span class="cl">└── build
</span></span><span class="line"><span class="cl">    ├── Calculator.abi
</span></span><span class="line"><span class="cl">    └── Calculator.bin
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="部署智能合约">部署智能合约</h2>
<p>新建一个node.js 项目<code>deploy</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mkdir -p deploy/
</span></span><span class="line"><span class="cl">cd deploy/
</span></span><span class="line"><span class="cl">npm init
</span></span><span class="line"><span class="cl">touch index.js
</span></span></code></pre></td></tr></table>
</div>
</div><p>安装<code>web3.js</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install web3
</span></span></code></pre></td></tr></table>
</div>
</div><p>在<code>index.js</code>中加入如下代码:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Web3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;web3&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">web3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Web3</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8545&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">bytecode</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;../build/Calculator.bin&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">abi</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;../build/Calculator.abi&#39;</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="kr">async</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">ganacheAccounts</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">getAccounts</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">web3</span><span class="p">.</span><span class="nx">eth</span><span class="p">.</span><span class="nx">Contract</span><span class="p">(</span><span class="nx">abi</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">calculator</span><span class="p">.</span><span class="nx">deploy</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">data</span><span class="o">:</span> <span class="nx">bytecode</span>
</span></span><span class="line"><span class="cl">    <span class="p">}).</span><span class="nx">send</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">from</span><span class="o">:</span> <span class="nx">ganacheAccounts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">deployment</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Contract was deployed at the following address:&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">deployment</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">address</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">})();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意,  上面的部署代码没有使用账户的私钥, 是因为在前面的步骤中, 账户已经解锁了</p>
</blockquote>
<p><strong>在部署之前需要先启动挖矿</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">OSX MP16 ~/Downloads/pri/mychain ❯ ./attach.sh 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; miner.start<span class="o">()</span>
</span></span><span class="line"><span class="cl">null
</span></span><span class="line"><span class="cl">&gt; eth.blockNumber
</span></span><span class="line"><span class="cl"><span class="m">26</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>部署:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">OSX MP16 ~/Downloads/pri/c/d/deploy_js ❯ node ./index.js 
</span></span><span class="line"><span class="cl">Contract was deployed at the following address:
</span></span><span class="line"><span class="cl">0x1F55d61D5Aa8eC92FD1Da0f19FaC9D552A29DBBF
</span></span></code></pre></td></tr></table>
</div>
</div><p>部署成功, 停掉挖矿, 否则电脑巨烫&hellip;</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; miner.stop<span class="o">()</span>
</span></span><span class="line"><span class="cl">null
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="调用智能合约">调用智能合约</h2>
<p>调用智能合约就和 <a href="https://yinhui1984.github.io/%e4%bb%8e%e9%9b%b6%e5%bc%80%e5%a7%8b%e7%bc%96%e5%86%99%e6%99%ba%e8%83%bd%e5%90%88%e7%ba%a6-%e4%bd%bf%e7%94%a8traffle%e5%a5%97%e4%bb%b6/#7-demoapp%e8%b0%83%e7%94%a8%e5%90%88%e7%ba%a6" target="_blank" rel="noopener noreffer ">从零开始编写智能合约-使用traffle套件</a>中的一样了, 可以跳转到那里进行参考</p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2022-07-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" data-title="从零开始编写智能合约-手工打造" data-hashtags="solidity,ethereum,go-ethereum,python"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" data-hashtag="solidity"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" data-title="从零开始编写智能合约-手工打造"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" data-title="从零开始编写智能合约-手工打造"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://yinhui1984.github.io/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E6%89%8B%E5%B7%A5%E6%89%93%E9%80%A0/" data-title="从零开始编写智能合约-手工打造"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/solidity/">solidity</a>,&nbsp;<a href="/tags/ethereum/">ethereum</a>,&nbsp;<a href="/tags/go-ethereum/">go-ethereum</a>,&nbsp;<a href="/tags/python/">python</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6-%E4%BD%BF%E7%94%A8truffle%E5%A5%97%E4%BB%B6/" class="prev" rel="prev" title="从零开始编写智能合约-使用traffle套件"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>从零开始编写智能合约-使用traffle套件</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.95.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/yinhui1984" target="_blank">zhouyinhui</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
